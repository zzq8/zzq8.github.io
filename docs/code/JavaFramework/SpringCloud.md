---
article: false
updated: 2025-09-20 20:49:46
---
# SpringCloud

## ä¸ºä»€ä¹ˆè¦ç”¨åˆ†å¸ƒå¼

> åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä¸æ˜¯æŒ‡ç³»ç»Ÿåˆ†å¸ƒåœ¨ä¸åŒè®¡ç®—æœºï¼Œè€Œæ˜¯æŒ‡ç³»ç»ŸåŒ…å«**==ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šäº¤äº’çš„è¿›ç¨‹==**ï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦ä½äºåŒä¸€ä¸»æœºä¸Šã€‚
>
> -- [ã€Šä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿã€‹](https://notes.eatonphil.com/2025-08-09-what-even-is-distributed-systems.html)



> é‚£ä¹ˆé—®é¢˜æ¥äº†, httpè°ƒç”¨ç®—åˆ†å¸ƒå¼å—  è¿˜æ˜¯åªæœ‰RPCè°ƒç”¨
>
> RPCæ¯”httpçš„ä¼˜åŠ¿, ä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨ rpc

```
è¿™ä¸ªé—®é¢˜é—®å¾—éå¸¸åˆ°ä½ ğŸ‘Œ æˆ‘ç»™ä½ åˆ†æˆä¸‰å±‚æ¥è®²ï¼š

â¸»

1. ä»€ä¹ˆå«åˆ†å¸ƒå¼ï¼Ÿ

ä½ è¯´çš„é‚£å¥å®šä¹‰æ²¡é”™ï¼š
	â€¢	åˆ†å¸ƒå¼ç³»ç»Ÿ = ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹äº¤äº’åä½œå®Œæˆä¸€ä»¶äº‹ï¼Œä¸ç®¡è¿™äº›è¿›ç¨‹æ˜¯ä¸æ˜¯åœ¨åŒä¸€å°æœºå™¨ä¸Šã€‚

æ‰€ä»¥ï¼š
	â€¢	å¦‚æœä¸¤ä¸ªè¿›ç¨‹é€šè¿‡ HTTP è°ƒç”¨äº¤äº’ â†’ è¿™å°±æ˜¯åˆ†å¸ƒå¼
	â€¢	å¦‚æœä¸¤ä¸ªè¿›ç¨‹é€šè¿‡ RPC è°ƒç”¨äº¤äº’ â†’ è¿™åŒæ ·æ˜¯åˆ†å¸ƒå¼

ğŸ‘‰ å…³é”®ç‚¹åœ¨â€œè¿›ç¨‹é—´äº¤äº’â€ï¼Œè€Œä¸æ˜¯è°ƒç”¨æ–¹å¼ã€‚

â¸»

2. HTTP è°ƒç”¨ç®—ä¸ç®—åˆ†å¸ƒå¼ï¼Ÿ

å½“ç„¶ç®—ã€‚
	â€¢	ä¾‹å¦‚ä¸€ä¸ªç”µå•†ç³»ç»Ÿï¼šå‰ç«¯è°ƒç”¨åç«¯æ¥å£ï¼ˆHTTPï¼‰ï¼Œåç«¯å†è°ƒæ”¯ä»˜ç½‘å…³ï¼ˆHTTPï¼‰
	â€¢	è¿™äº›æœåŠ¡æœ¬è´¨ä¸Šéƒ½æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†

æ‰€ä»¥åˆ«è¢«â€œRPCâ€è¿™ä¸ªè¯å¡ä½äº†ï¼ŒHTTP å°±æ˜¯æœ€å¸¸è§çš„ä¸€ç§ RPC åè®®å®ç°ï¼ˆHTTP æ˜¯åº”ç”¨å±‚åè®®ï¼ŒRPC å¯ä»¥è·‘åœ¨ HTTP ä¹‹ä¸Šï¼‰ã€‚

â¸»

3. RPC vs HTTP çš„åŒºåˆ«å’Œä¼˜åŠ¿

RPCï¼ˆRemote Procedure Callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰ä¸æ˜¯ä¸€ä¸ªå…·ä½“åè®®ï¼Œè€Œæ˜¯ä¸€ç§è°ƒç”¨æŠ½è±¡ï¼šåƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡ã€‚
HTTP æ˜¯åº•å±‚åè®®ï¼ˆåŸºäº TCPï¼‰ï¼ŒRPC å¾€å¾€å°è£…åœ¨å®ƒä¹‹ä¸Šã€‚

åŒºåˆ«ï¼š

ç»´åº¦	HTTP è°ƒç”¨	RPC è°ƒç”¨
åè®®	åŸºäº HTTP/1.1ã€HTTP/2ã€REST é£æ ¼	å¸¸ç”¨ TCP/HTTP2 + äºŒè¿›åˆ¶åè®®ï¼ˆå¦‚ gRPCï¼‰
åºåˆ—åŒ–	ä¸€èˆ¬ JSONã€XMLï¼ˆæ–‡æœ¬å‹ï¼Œå†—ä½™å¤§ï¼‰	å¸¸ç”¨ Protobufã€Thriftï¼ˆäºŒè¿›åˆ¶ï¼Œé«˜æ•ˆï¼‰
è°ƒç”¨æŠ½è±¡	é¢å‘èµ„æºï¼ˆGET/POST è·¯ç”±+å‚æ•°ï¼‰	é¢å‘æœåŠ¡æ¥å£/æ–¹æ³•ï¼ˆåƒæœ¬åœ°è°ƒç”¨ï¼‰
æ€§èƒ½	æ–‡æœ¬åºåˆ—åŒ– + HTTP header å†—ä½™ï¼Œæ€§èƒ½ç›¸å¯¹ä½	äºŒè¿›åˆ¶åºåˆ—åŒ–ï¼Œå¸¦å®½æ›´å°ï¼Œå»¶è¿Ÿæ›´ä½
ç”Ÿæ€	ç®€å•é€šç”¨ï¼Œæµè§ˆå™¨/æœåŠ¡ç«¯ç›´æ¥æ”¯æŒ	å¤šç”¨äºæœåŠ¡é—´é€šä¿¡ï¼Œä¾èµ– SDK æ”¯æŒ


â¸»

RPC ä¼˜åŠ¿ï¼š
	1.	æ€§èƒ½æ›´å¥½
	â€¢	Protobuf/Thrift äºŒè¿›åˆ¶åºåˆ—åŒ–ï¼Œä½“ç§¯æ›´å°ï¼Œè§£ææ›´å¿«ã€‚
	â€¢	gRPC åŸºäº HTTP/2ï¼Œå¤šè·¯å¤ç”¨ã€å¤´éƒ¨å‹ç¼©ï¼Œå‡å°‘è¿æ¥å¼€é”€ã€‚
	2.	æ¥å£æŠ½è±¡æ›´è‡ªç„¶
	â€¢	å†™ RPC å°±åƒå†™æœ¬åœ°æ–¹æ³•ï¼šuserService.getUser(id)
	â€¢	HTTP REST é£æ ¼è¦è‡ªå·±æ‹¼è·¯ç”±å’Œ JSON å‚æ•°ã€‚
	3.	å†…ç½®åŠŸèƒ½æ›´å¤š
	â€¢	gRPC/Dubbo ç­‰ RPC æ¡†æ¶é€šå¸¸è‡ªå¸¦ æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€ç†”æ–­ã€è¶…æ—¶æ§åˆ¶ã€ç‰ˆæœ¬ç®¡ç†ï¼Œé€‚åˆå¤§è§„æ¨¡å¾®æœåŠ¡ã€‚
	â€¢	HTTP åŸç”Ÿæ¯”è¾ƒâ€œè£¸â€ï¼Œè¦è‡ªå·±è¡¥å……è¿™äº›èƒ½åŠ›ã€‚

â¸»

é‚£ä¸ºä»€ä¹ˆä¸æ˜¯â€œå¿…é¡»â€ç”¨ RPCï¼Ÿ
	â€¢	å°è§„æ¨¡ç³»ç»Ÿï¼Œç”¨ HTTP + JSON å°±å¤Ÿäº†ï¼Œç®€å•ç›´è§‚ï¼Œè°ƒè¯•æ–¹ä¾¿ï¼ˆcurl å°±èƒ½è°ƒï¼‰ã€‚
	â€¢	å¤§è§„æ¨¡å¾®æœåŠ¡ï¼Œæ€§èƒ½ç“¶é¢ˆã€æ²»ç†å¤æ‚æ—¶ï¼ŒRPC çš„ä¼˜åŠ¿æ‰ä¼šæ˜æ˜¾ã€‚

ğŸ‘‰ æ‰€ä»¥ï¼šRPC ä¸æ˜¯æ¯” HTTP é«˜çº§ï¼Œè€Œæ˜¯æ›´é€‚åˆå¤§è§„æ¨¡å¾®æœåŠ¡åœºæ™¯çš„å·¥ç¨‹åŒ–è§£å†³æ–¹æ¡ˆã€‚

â¸»

è¦ä¸è¦æˆ‘ç»™ä½ ç”»ä¸€ä¸ªã€ŒHTTP vs RPC è°ƒç”¨é“¾å¯¹æ¯”å›¾ã€ï¼Œç›´è§‚å±•ç¤ºå®ƒä»¬åœ¨æ•°æ®æ ¼å¼ã€ä¼ è¾“æ•ˆç‡ä¸Šçš„å·®åˆ«ï¼Ÿ
```

RPC æ¯” http ä¼˜åŠ¿

1. **æ€§èƒ½æ›´å¥½**: äºŒè¿›åˆ¶åºåˆ—åŒ–

2. **å†…ç½®åŠŸèƒ½æ›´å¤š**: æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€ç†”æ–­

3. **å†™ RPC å°±åƒå†™æœ¬åœ°æ–¹æ³•** -> è¿™ä¸ªhttpä¹Ÿå¯ä»¥å•Š, æ˜¯ä¸æ˜¯å…³é”®ç‚¹å†ä¸è¿”å›å¯¹è±¡, httpå¯èƒ½æ›´å¤šæ˜¯ json è€Œ rpc å¯ä»¥æ˜¯å¯¹æ–¹æä¾›åŒ…é‡Œçš„å¯¹è±¡

   1. **HTTP**: 

      1. å **èµ„æºå¯¼å‘**ï¼Œä½ åœ¨è°ƒçš„æ˜¯ä¸€ä¸ª URL + åŠ¨ä½œï¼ˆGET /user/123 æˆ– POST /userï¼‰ã€‚
      2. è¿”å›å€¼é€šå¸¸æ˜¯ **JSON æ–‡æœ¬**ï¼Œä½ è¦è‡ªå·±è§£ææˆå¯¹è±¡ã€‚
      3. æ›´åƒæ˜¯åœ¨â€œè¯·æ±‚ä¸€ä¸ªèµ„æºâ€ï¼Œè€Œä¸æ˜¯â€œè°ƒç”¨ä¸€ä¸ªæ–¹æ³•â€ã€‚

   2. 

      RPC

      1. å æ–¹æ³•å¯¼å‘ï¼Œè°ƒç”¨å°±åƒï¼š`User user = userService.getUser(123);` æœ¬åœ°è°ƒä¸ªæ–¹æ³•, ä½ å‡ ä¹æ„Ÿè§‰ä¸åˆ°è¿™æ˜¯è¿œç¨‹è°ƒç”¨ï¼ŒçœŸçš„å°±åƒåœ¨è°ƒæœ¬åœ°å‡½æ•°ã€‚
      2. æ¡†æ¶åº•å±‚æŠŠè¯·æ±‚åºåˆ—åŒ–ï¼ˆå¯èƒ½ç”¨ Protobufï¼‰ã€å‘ç½‘ç»œåŒ…ã€ååºåˆ—åŒ–ï¼Œæœ€åç›´æ¥è¿˜ç»™ä½ ä¸€ä¸ª å¼ºç±»å‹å¯¹è±¡
         1. ç¼–è¯‘æ—¶ç›´æ¥ç”Ÿæˆ User ç±» (ç›´æ¥å¯¹åº” SDK é‡Œçš„ç±»)ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ å…±ç”¨åŒä¸€å¥—å®šä¹‰,   ç›¸å¯¹ http å°‘äº†â€œJSON â†” å¯¹è±¡â€çš„æ‰‹åŠ¨è½¬æ¢





***





> å°šç¡…è°·å‘¨é˜³è€å¸ˆ 2022/5/23   è¯¦ç»†ç¬”è®°çœ‹è„‘å›¾ å’Œ [åˆ«äººçš„ç¬”è®°](https://blog.csdn.net/u011863024/article/details/114298270) å’Œ [åˆ«äººçš„ä»£ç ](https://gitee.com/lixiaogou/cloud2020/tree/master/)ï¼Œè¿™é‡Œåªè®°å½•äºè‡ªå·±è€Œè¨€æ˜¯é‡ç‚¹çš„å†…å®¹

> æ ‡é¢˜ æ–°æ—§äº¤æ›¿å­¦ä¹ 
>
> 14ç§ç»„ä»¶æŠ€æœ¯çš„å­¦ä¹ ï¼Œ30å¤šä¸ªModelã€‚éœ€è¦å¤šåŠ¨æ‰‹ï¼ä¸è¦ä¸€å¬å°±ä¼šä¸€åŠ¨æ‰‹å°±åºŸã€‚   **çŸ¥è¡Œåˆä¸€**
>
> ä¸è¦è¢«å„ç§é«˜å¤§ä¸Šçš„è¯æ±‡å”¬ä½äº†ï¼Œéƒ½æ˜¯ä¸Šå±‚ï¼ˆåº”ç”¨å±‚ï¼‰çš„ä¸œè¥¿ï¼ŒåŸºæœ¬æ²¡æœ‰ä»€ä¹ˆç®—æ³•ï¼Œè·Ÿç€è§†é¢‘æ•™ç¨‹å­¦ï¼Œå…¶å®è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ã€‚
>
> 3Wæ³•â€”whatï¼Œwhyï¼Œhowçš„è¿ç”¨
>
> ä»¥åç¢°åˆ°ä»€ä¹ˆé—®é¢˜å…ˆæŸ¥ å®˜ç½‘æ–‡æ¡£ï¼Œå†å»Google ChartGPT ï¼

## ==------æœåŠ¡æ³¨å†Œä¸å‘ç°------==

## ä¸€ã€å‰è¨€

### [1. ä»‹ç»](https://www.yuque.com/atguigu/springboot/na3pfd#gXHqd)

> SpringCloud -> åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œæ˜¯å¤šç§å¾®æœåŠ¡æ¶æ„è½åœ°æŠ€æœ¯çš„é›†åˆä½“ï¼Œä¿—ç§°å¾®æœåŠ¡å…¨å®¶æ¡¶
>
> ç›´æ¥çœ‹æå‡ºè€…çš„ Blog ï¼ï¼ï¼ ==Click the title acquire==



>åˆ†å¸ƒå¼ (éƒ¨ç½²æ–¹å¼)  vs  å¾®æœåŠ¡ (æ¶æ„é£æ ¼)  

ç”Ÿäº§ç¯å¢ƒä¸‹çš„å¾®æœåŠ¡è‚¯å®šæ˜¯åˆ†å¸ƒå¼éƒ¨ç½²çš„

ä½†æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²çš„åº”ç”¨ä¸ä¸€å®šæ˜¯å¾®æœåŠ¡æ¶æ„çš„ï¼Œæ¯”å¦‚é›†ç¾¤éƒ¨ç½²ï¼Œå®ƒæ˜¯æŠŠç›¸åŒåº”ç”¨å¤åˆ¶åˆ°ä¸åŒæœåŠ¡å™¨ä¸Šï¼Œä½†æ˜¯é€»è¾‘åŠŸèƒ½ä¸Šè¿˜æ˜¯å•ä½“åº”ç”¨ã€‚



> å¾®æœåŠ¡ç†è§£ï¼šå¯ä»¥ç²—é„™çš„ç†è§£ä¸º SpringBoot å¼€å‘çš„ä¸€ä¸ªä¸ªæ¨¡å—å•å…ƒ

æ¶æ„æ¨¡å¼ï¼ŒæŠŠå•ä¸€åº”ç”¨ç¨‹åºåˆ’åˆ†æˆä¸€ç»„å°çš„æœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´ç›¸äº’åè°ƒã€ç›¸äº’é…åˆã€‚

æ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨å…¶ç‹¬ç«‹çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡ä¸æœåŠ¡é—´é‡‡ç”¨è½»é‡çº§çš„é€šä¿¡æœºåˆ¶ç›¸äº’å†™ä½œï¼ˆé€šå¸¸æ˜¯åŸºäºHTTPåè®®çš„RESTful APIï¼‰

![image-20220523154541922](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202205231606492.png)



å¼ºå°±å¼ºåœ¨å®ƒæ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œåƒè‹¹æœç”Ÿæ€ã€‚ ä¸ç„¶æˆ‘æ‰‹æœºè‹¹æœç”µè„‘åä¸ºå¹³æ¿å°ç±³ç›´æ¥åè°ƒçš„è¯å°±ä¼šéº»çƒ¦ã€‚



æ‚ä¸€çœ¼äº¬ä¸œçš„ï¼š

![image-20220523161504577](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202205231615718.png)





éœ€è¦å­¦ä¹ ï¼šæ³¨æ„æœ‰ä¸€äº›ä¼šæœ‰å˜æ›´ï¼Œæ–°çš„è€çš„éƒ½å­¦ï¼

![image-20220523162302969](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202205231623078.png)



### [2. å†æ¬¡æ€»ç»“ä»€ä¹ˆæ˜¯å¾®æœåŠ¡](https://www.yuque.com/atguigu/springboot/na3pfd#gXHqd)

> ç›´æ¥çœ‹æå‡ºè€…çš„ Blog ï¼ï¼ï¼ ==Click the title acquire==

- å¾®æœåŠ¡æ˜¯ä¸€ç§æ¶æ„é£æ ¼
- ä¸€ä¸ªåº”ç”¨æ‹†åˆ†ä¸ºä¸€ç»„å°å‹æœåŠ¡
- æ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹å†…ï¼Œä¹Ÿå°±æ˜¯å¯ç‹¬ç«‹éƒ¨ç½²å’Œå‡çº§
- æœåŠ¡ä¹‹é—´ä½¿ç”¨è½»é‡çº§HTTPäº¤äº’
- æœåŠ¡å›´ç»•ä¸šåŠ¡åŠŸèƒ½æ‹†åˆ†
- å¯ä»¥ç”±å…¨è‡ªåŠ¨éƒ¨ç½²æœºåˆ¶ç‹¬ç«‹éƒ¨ç½²
- å»ä¸­å¿ƒåŒ–ï¼ŒæœåŠ¡è‡ªæ²»ã€‚æœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€ã€ä¸åŒçš„å­˜å‚¨æŠ€æœ¯



## äºŒã€ç‰ˆæœ¬é€‰æ‹©

> GAï¼šGeneral Availabilityï¼Œæ­£å¼å‘å¸ƒçš„ç‰ˆæœ¬ï¼Œå®˜æ–¹å¼€å§‹æ¨èå¹¿æ³›ä½¿ç”¨ï¼Œå›½å¤–æœ‰çš„ç”¨GAæ¥è¡¨ç¤ºreleaseç‰ˆæœ¬ã€‚
>
> RELEASEï¼šæ­£å¼å‘å¸ƒç‰ˆï¼Œå®˜æ–¹æ¨èä½¿ç”¨çš„ç‰ˆæœ¬ï¼Œæœ‰çš„ç”¨GAæ¥è¡¨ç¤ºã€‚æ¯”å¦‚springã€‚

äº†è§£ï¼š

Spring Cloud é‡‡ç”¨äº†**è‹±å›½ä¼¦æ•¦åœ°é“ç«™**çš„åç§°æ¥å‘½åï¼Œå¹¶ç”±åœ°é“ç«™åç§°å­—æ¯ A-Z ä»¥æ­¤ç±»æ¨çš„å½¢å¼æ¥å‘å¸ƒè¿­ä»£ç‰ˆæœ¬ã€‚



å…·ä½“ç‰ˆæœ¬é€‰æ‹©å¯ä»¥çœ‹ Spring Cloud å®˜ç½‘ overview ä¸‹é¢æœ‰è¯´æ˜ã€‚Spring Cloud å¯¹åº”çš„ Spring Boot ç‰ˆæœ¬ï¼š

![image-20220523170052524](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202205231700591.png)



å…·ä½“çœ‹æ›´è¯¦ç»†çš„ä¾èµ– https://start.spring.io/actuator/info



## ä¸‰ã€==ç»„ä»¶åœæ›´è¯´æ˜==

> æ€»ç»“ï¼šAli çš„ Nacos å¾ˆå‰å®³
>
> æŠŠå›¾ç‰‡æ”¾å¤§çœ‹ï¼

![image-20220523172626378](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202205231726500.png)

## å››ã€ç¼–ç æ„å»º

> çº¦å®š > é…ç½® > ç¼–ç 

ideaçš„é…ç½® + çˆ¶å·¥ç¨‹çš„é…ç½®, å…·ä½“çœ‹é¡¹ç›®ä½“ç°

### 1. IDEA æ–°å»º çˆ¶å·¥ç¨‹

#### 1.1 dependencyManagement æ ‡ç­¾

> é€šå¸¸ä¼šåœ¨ä¸€ä¸ªç»„ç»‡æˆ–è€…é¡¹ç›®çš„æœ€é¡¶å±‚çš„ **çˆ¶POM** ä¸­çœ‹åˆ°dependencyManagementå…ƒç´ ã€‚
>
> å­å·¥ç¨‹ä¼šå‘ä¸Šæ‰¾ dependencyManagement ç„¶åç”¨ å…¶ (çˆ¶å·¥ç¨‹) å¼•å…¥çš„ jar åŒ…çš„ç‰ˆæœ¬å·
>
> æ³¨æ„: çˆ¶å·¥ç¨‹è¿™é‡Œåªæ˜¯èµ·ä¸€ä¸ªå®šä¹‰ä½œç”¨ -> dependencyManagementé‡Œ**åªæ˜¯å£°æ˜ä¾èµ–ï¼Œå¹¶ä¸å®ç°å¼•å…¥**ï¼Œå› æ­¤å­é¡¹ç›®éœ€è¦æ˜¾ç¤ºçš„å£°æ˜éœ€è¦ç”¨çš„ä¾èµ–ã€‚
>
> [å¼ºåŠ›æ¨èçœ‹è¿™ç¯‡](https://zhuanlan.zhihu.com/p/99643458)  \<dependencyManagement> é’ˆå¯¹çš„æ˜¯å„¿å­æ¨¡å—ï¼ˆçˆ¶å­ï¼‰ï¼Œä¸æ˜¯è‡ªå·±æœ¬èº«çš„æ¨¡å—

```xml
<!-- å­æ¨¡å—ç»§æ‰¿ä¹‹åï¼Œæä¾›ä½œç”¨ï¼š
      é”å®šç‰ˆæœ¬+å­modlueä¸ç”¨å†™groupIdå’Œversion -->
<dependencyManagement>
    <dependencies>
        <dependency>
        <groupId>mysq1</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>5.1.2</version>
        </dependency>
        
      <!--spring boot 2.2.2, å­æ¨¡å—æ•´ä¸ª spring boot ç›¸å…³çš„éƒ½æ˜¯2.2.2.RELEASE-->
      <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-dependencies</artifactId>
        <version>2.2.2.RELEASE</version>
        <type>pom</type>
        <scope>import</scope>
      </dependency>
    <dependencies>
</dependencyManagement>
        
        	çˆ¶
        #############
        	å­
        
<dependencies>
    <dependency>
        <groupId>mysq1</groupId>
        <artifactId>mysql-connector-java</artifactId>
    </dependency>
</dependencies>
        
<!-- è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯ï¼šå¦‚æœæœ‰å¤šä¸ªå­é¡¹ç›®éƒ½å¼•ç”¨åŒä¸€æ ·ä¾èµ–ï¼Œåˆ™å¯ä»¥é¿å…åœ¨æ¯ä¸ªä½¿ç”¨çš„å­é¡¹ç›®é‡Œéƒ½å£°æ˜ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œè¿™æ ·å½“æƒ³å‡çº§æˆ–åˆ‡æ¢åˆ°å¦ä¸€ä¸ªç‰ˆæœ¬æ—¶ï¼Œåªéœ€è¦åœ¨é¡¶å±‚çˆ¶å®¹å™¨é‡Œæ›´æ–°ï¼Œè€Œä¸éœ€è¦ä¸€ä¸ªä¸€ä¸ªå­é¡¹ç›®çš„ä¿®æ”¹ï¼›å¦å¤–å¦‚æœæŸä¸ªå­é¡¹ç›®éœ€è¦å¦å¤–çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œåªéœ€è¦å£°æ˜versionå°±å¯ã€‚-->        
```

æµ‹è¯•äº†ä¸€ä¸‹ï¼šå‘ç°å­ Model ç»§æ‰¿äº†çˆ¶çš„æ‰€æœ‰åŒ…æ‹¬ \<build> åªè¦æ³¨æ„å†™ artifactId å°±å¥½ !



#### 1.2 maven è·³è¿‡å•å…ƒæµ‹è¯•

> ==èŠ‚çº¦æ—¶é—´==

![image-20220523210748358](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202205232107484.png)



### 2. Rest å¾®æœåŠ¡å·¥ç¨‹æ„å»º

>åˆ›å»ºå¾®æœåŠ¡æ¨¡å—å¥—è·¯ï¼š

1. å»ºModule
2. æ”¹POM
3. å†™YML
4. ä¸»å¯åŠ¨
5. ä¸šåŠ¡ç±»

çƒ­éƒ¨ç½²å…¶å®å°±æ˜¯çƒ­é‡å¯ï¼ŒçœŸæ­£çš„çƒ­éƒ¨ç½²åªéƒ¨ç½²æ”¹åŠ¨çš„ å®˜æ–¹æ–‡æ¡£è¯´äº†éœ€è¦ä»˜è´¹ã€‚æ³¨æ„ï¼šå› ä¸ºå…¶é‡‡ç”¨çš„è™šæ‹Ÿæœºæœºåˆ¶ï¼Œè¯¥é¡¹é‡å¯æ˜¯å¾ˆå¿«çš„



#### 2.1 Springboot maven pluginæ’ä»¶åŸç†åŠä½œç”¨ã€æ‰©å±•ã€‘

==å¯èƒ½æˆ‘è¿˜æ˜¯ä¸ç†è§£ spring-boot-maven-pluginæ’ä»¶ä½œç”¨ï¼Œå®ƒçš„ä½œç”¨ä»…ä»…æ˜¯ä¸ºäº†é‡æ–°æ‰“åŒ…ç”Ÿæˆä¸€ä¸ª*.originalæ–‡ä»¶å—==

ä¸€èˆ¬çš„mavené¡¹ç›®çš„æ‰“åŒ…å‘½ä»¤ï¼Œä¸ä¼šæŠŠä¾èµ–çš„jaråŒ…ä¹Ÿæ‰“åŒ…è¿›å»çš„ï¼Œåªæ˜¯ä¼šæ”¾åœ¨jaråŒ…çš„åŒç›®å½•ä¸‹ï¼Œèƒ½å¤Ÿå¼•ç”¨å°±å¯ä»¥äº†ï¼Œä½†æ˜¯spring-boot-maven-pluginæ’ä»¶ï¼Œä¼šå°†ä¾èµ–çš„jaråŒ…å…¨éƒ¨æ‰“åŒ…è¿›å»ã€‚

https://www.jb51.net/article/197968.htm



åœ¨æ²¡æœ‰ä½¿ç”¨spring-boot-maven-pluginæ’ä»¶æ—¶ï¼Œæ‰“åŒ…çš„ç›®å½•åªæœ‰ä¸¤ä¸ªï¼ŒMETA-INFå’Œæˆ‘è‡ªå·±çš„é¡¹ç›®ä»£ç çš„ç›®å½•ã€‚

åªä¼šç”Ÿæˆä¸€ä¸ª .jar æ–‡ä»¶

![image-20220525204018181](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202205252040293.png)

åœ¨ä½¿ç”¨spring-boot-maven-pluginæ’ä»¶æ—¶ï¼Œæ‰“åŒ…åçš„ç›®å½•åŒ…æ‹¬ä¸‰ä¸ª

å¤šä¸€ä¸ª *.original æ–‡ä»¶

![image-20220525204651902](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202205252046930.png)

1. BOOT-INF
2. META-INF
3. org.springframework.boot.loaderï¼Œåœ¨libç›®å½•é‡ŒåŒ…å«äº†æˆ‘è‡ªå·±çš„é¡¹ç›®çš„ä»£ç ç›®å½•ï¼›



#### 2.2 ==restTemplate==

åœ¨æ²¡æœ‰è®² Ribbon ä¹‹å‰éƒ½å…ˆç”¨è¿™ä¸ªï¼

JDBCTemplateã€RedisTemplate

ä¸¤ä¸ªæœåŠ¡é—´çš„è°ƒç”¨ï¼š

* åŸå§‹çš„ web é˜¶æ®µ -> httpClient
* ç°åœ¨è¿›åŒ–äº†ä»¥å restTemplateï¼Œç›¸å½“äºç»™httpClient åšäº†ä¸€æ¬¡å°è£…ï¼Œå®ç°äº†ä¸¤ä¸ªæœåŠ¡çš„æ¨ªå‘è°ƒç”¨



### 3. å·¥ç¨‹é‡æ„

æ¯ä¸€ä¸ªæ¨¡å—éƒ½æœ‰ä¸€æ ·çš„ åŒ… åŒ…é‡Œçš„ç±»ä¹Ÿä¸€æ¨¡ä¸€æ ·ï¼Œè€ƒè™‘é‡æ„æå–å‡ºæ¥ installæˆjaråŒ…ä¾›å¤–é¢ç”¨

install(å®‰è£…è‡³æœ¬åœ°ä»“åº“)(åœ¨æœ¬åœ°Repositoryä¸­å®‰è£…jar)



## äº”ã€Eureka æœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ Ã—

å…¥é—¨ç¯‡å·²è®²å®Œï¼Œå¼€å§‹åŸºç¡€ç¯‡çš„å­¦ä¹ 

> è€çš„  **EurekaåŒ…å«ä¸¤ä¸ªç»„ä»¶:Eureka Serverå’ŒEureka Client**
>
> è¿™ä¸ªä¸œè¥¿ç›¸å½“äº ç‰©ä¸šå…¬å¸ï¼Œè€Œç»„ä»¶å°±æ˜¯ å…¥é©»ä¼ä¸š

### æ¦‚è¿°

ä¸Šé¢çš„æœåŠ¡é¡¹ç›®å®ä¾‹ä¸­ï¼ŒæœåŠ¡æä¾›æ–¹å¯¹å¤–æä¾›æœåŠ¡ï¼Œéœ€è¦å¯¹å¤–æš´éœ²è‡ªå·±çš„åœ°å€ï¼Œè€ŒæœåŠ¡è°ƒç”¨è€…éœ€è¦è®°å½•æœåŠ¡æä¾›è€…çš„åœ°å€ï¼Œå°†æ¥åœ°å€å‡ºç°å˜åŠ¨æ—¶ï¼Œéœ€è¦åŠæ—¶æ›´æ–°ã€‚

å½“æœåŠ¡æ•°é‡æ¯”è¾ƒå°‘æ—¶ï¼Œè¿™äº›ä¸ä¼šé€ æˆå›°æ‰°ï¼Œä¸€æ—¦æœåŠ¡æ•°é‡å¢å¤šï¼Œç®¡ç†ä¸Šå°±éå¸¸éº»çƒ¦ã€‚è¿™å°±éœ€è¦æœåŠ¡æ³¨å†Œä¸­å¿ƒæ¥ç»Ÿä¸€ç®¡ç†ã€‚



### 1.1 ä»€ä¹ˆæ˜¯æœåŠ¡æ²»ç†

Spring Cloudå°è£…äº†Netflix å…¬å¸å¼€å‘çš„Eurekaæ¨¡å—æ¥å®ç°æœåŠ¡æ²»ç†

åœ¨ä¼ ç»Ÿçš„RPCè¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œç®¡ç†æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨æœåŠ¡æ²»ç†ï¼Œç®¡ç†æœåŠ¡äºæœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»ï¼Œå¯ä»¥å®ç°æœåŠ¡è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰ï¼Œå®ç°æœåŠ¡å‘ç°ä¸æ³¨å†Œã€‚



### 1.2 ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œä¸å‘ç°

Eurekaé‡‡ç”¨äº†CSçš„è®¾è®¡æ¶æ„ï¼ŒEureka Severä½œä¸ºæœåŠ¡æ³¨å†ŒåŠŸèƒ½çš„æœåŠ¡å™¨ï¼Œå®ƒæ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚è€Œç³»ç»Ÿä¸­çš„å…¶ä»–å¾®æœåŠ¡ï¼Œä½¿ç”¨Eurekaçš„å®¢æˆ·ç«¯è¿æ¥åˆ° Eureka Serverå¹¶ç»´æŒ **å¿ƒè·³è¿æ¥**ã€‚è¿™æ ·ç³»ç»Ÿçš„ç»´æŠ¤äººå‘˜å°±å¯ä»¥é€šè¿‡Eureka Serveræ¥ç›‘æ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚

åœ¨æœåŠ¡æ³¨å†Œä¸å‘ç°ä¸­ï¼Œæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒã€‚å½“æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæŠŠå½“å‰è‡ªå·±æœåŠ¡å™¨çš„ä¿¡æ¯æ¯”å¦‚æœåŠ¡åœ°å€é€šè®¯åœ°å€ç­‰ä»¥åˆ«åæ–¹å¼æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šã€‚å¦ä¸€æ–¹(æ¶ˆè´¹è€…æœåŠ¡æä¾›è€…)ï¼Œä»¥è¯¥åˆ«åçš„æ–¹å¼å»æ³¨å†Œä¸­å¿ƒä¸Šè·å–åˆ°å®é™…çš„æœåŠ¡é€šè®¯åœ°å€ï¼Œç„¶åå†å®ç°æœ¬åœ°RPCè°ƒç”¨RPCè¿œç¨‹è°ƒç”¨æ¡†æ¶æ ¸å¿ƒè®¾è®¡æ€æƒ³:åœ¨äºæ³¨å†Œä¸­å¿ƒï¼Œå› ä¸ºä½¿ç”¨æ³¨å†Œä¸­å¿ƒç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¸€ä¸ªä¾èµ–å…³ç³»(æœåŠ¡æ²»ç†æ¦‚å¿µ)ã€‚åœ¨ä»»ä½•RPCè¿œç¨‹æ¡†æ¶ä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒå­˜æ”¾æœåŠ¡åœ°å€ç›¸å…³ä¿¡æ¯(æ¥å£åœ°å€)



### 1.3 Eureka é›†ç¾¤

Eureka Server äº’ç›¸æŒ‡å‘å¯¹æ–¹ ã€æœ‰å‘å›¾ã€‘

>é¢˜å¤–è¯ï¼šrpc æ˜¯ä¸€ç§æ€æƒ³ ä¸€ç§æ¦‚å¿µ
>
>é¢˜å¤–è¯ï¼šå¤šå°æœåŠ¡å™¨ Session æ€ä¹ˆå…±äº«ï¼šRedis
>
>çœ‹è¿™ä¸ªå›¾ Eureka å’Œ Provider éƒ½æ˜¯å¤šä¸ªé›†ç¾¤ï¼Œä¸ºäº†è¾¾åˆ°é«˜å¯ç”¨

![image-20220527162304318](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202205271623284.png)

è§£å†³åŠæ³•ï¼šæ­å»º Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤ï¼Œå®ç°è´Ÿè½½å‡è¡¡ + æ•…éšœå®¹é”™



### 1.4 Service Provider é›†ç¾¤

> æ³¨æ„ 80 çš„æ¶ˆè´¹è€…ä¸èƒ½æŠŠ Service Provider çš„åŸŸåå†™æ­»ï¼Œè¦å†™æˆæ³¨å†Œè¿› Eureka çš„æœåŠ¡åˆ«å
>
> è®°å¾—å¸¦ä¸Š http:// è¿™ä¸ªå‰ç¼€

http://localhost:8001  <---æ¢æˆ--->  http://CLOUD-PAYMENT-SERVICE



> ä½¿ç”¨@LoadBalancedæ³¨è§£èµ‹äºˆRestTemplateè´Ÿè½½å‡è¡¡çš„èƒ½åŠ›
>
> ä¸ç„¶ä¼šæŠ¥é”™

```java
@Bean
@LoadBalanced//ä½¿ç”¨@LoadBalancedæ³¨è§£èµ‹äºˆRestTemplateè´Ÿè½½å‡è¡¡çš„èƒ½åŠ›
public RestTemplate getRestTemplate(){
    return new RestTemplate();
}
```



##### actuator å¾®æœåŠ¡ä¿¡æ¯å®Œå–„

>ä½¿ç”¨ spring-boot-starter-actuator å¯ä»¥ç”¨äºæ£€æµ‹ç³»ç»Ÿçš„å¥åº·æƒ…å†µã€å½“å‰çš„Beansã€ç³»ç»Ÿçš„ç¼“å­˜ç­‰ï¼Œå…·ä½“å¯æ£€æµ‹çš„å†…å®¹å‚è€ƒä¸‹é¢çš„é“¾æ¥ï¼š https://docs.spring.io/spring-boot/docs/2.6.1/reference/htmlsingle/#actuator.endpoints.exposing



### 1.5 æœåŠ¡å‘ç° Discovery

> @EnableDiscoveryClient å¾ˆé‡è¦
>
> ä»¥å @EnableEurekaClient è¢« zookeeperã€nacos ä»£æ›¿ï¼Œä½†æ˜¯ä¸Šé¢è¿™ä¸ªæ³¨è§£ä¸ä¼š

ç›¸å½“äºç½‘ç«™ä¸Šçš„å…³äºæˆ‘ï¼Œå¯ä»¥çœ‹åˆ°å„ä¸ªæ³¨å†ŒæœåŠ¡çš„ä¿¡æ¯

å¯¹äºæ³¨å†Œè¿›eurekaé‡Œé¢çš„å¾®æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡æœåŠ¡å‘ç°æ¥è·å¾—è¯¥æœåŠ¡çš„ä¿¡æ¯

æ³¨æ„æ˜¯è¿™ä¸ªåŒ…ä¸‹é¢çš„ cloud çš„ï¼Œå°±å¦‚æˆ‘ç¬¬äºŒå¥è¯´çš„ï¼Œè¿™ä¸ªæ³¨è§£ä¼šå¸¸ç”¨ï¼Œä¸æ˜¯ Eureka çš„ï¼šimport org.springframework.cloud.client.discovery.DiscoveryClient;



### 1.6 Eurekaè‡ªæˆ‘ä¿æŠ¤ç†è®ºçŸ¥è¯†

é€šä¿—æ¥è®²ï¼š**ç»æƒ…ç‰ˆ** ï¼Œå°±æ˜¯æ”¹é…ç½® ç¦æ­¢è‡ªæˆ‘ä¿æŠ¤

åŸå…ˆï¼š

ä¸€å¥è¯ï¼šæŸæ—¶åˆ»æŸä¸€ä¸ªå¾®æœåŠ¡ä¸å¯ç”¨äº†ï¼ŒEurekaä¸ä¼šç«‹åˆ»æ¸…ç†ï¼Œä¾æ—§ä¼šå¯¹è¯¥å¾®æœåŠ¡çš„ä¿¡æ¯è¿›è¡Œä¿å­˜ã€‚

ä¸ºäº†EurekaClientå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œé˜²æ­¢ä¸EurekaServerç½‘ç»œä¸é€šæƒ…å†µä¸‹ï¼ŒEurekaServerä¸ä¼šç«‹åˆ»å°†EurekaClientæœåŠ¡å‰”é™¤



## å…­ã€Zookeeper æ›¿ä»£ Eureka

#### å› ä¸ºéœ€è¦ è™šæ‹Ÿæœº æš‚æ—¶æç½®ï¼Œè¿™ä¸€èŠ‚è‡ªå·±è¿˜æ²¡æœ‰å®è·µï¼ï¼ï¼

> ç›¸å¯¹ Eureka ä¸åŒæ˜¯è¿™ä¸ªæ˜¯ä¸Šé¢æåˆ°çš„ æ— æƒ…ç‰ˆï¼Œæœ‰å°±æ˜¯æœ‰æ²¡æœ‰å°±æ˜¯æ²¡æœ‰ï¼Œæ˜¯**ä¸´æ—¶èŠ‚ç‚¹** ï¼Œæ²¡æœ‰Eurekaé‚£å«æƒ…è„‰è„‰ã€‚
>
> éœ€è¦åœ¨ linux ä¸Šæ“ä½œ zookeeper



> Qï¼š==éœ€è¦æ˜ç™½ä¸ºä»€ä¹ˆå’Œ Eureka ä¸ä¸€æ ·è¿™ä¸ªéœ€è¦ linuxï¼Ÿï¼Ÿï¼Ÿ==
>
> Aï¼š**eurekaè¦å»ºä¸ªspringbootï¼Œè€ŒZKåœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²å°±å¼€äº†åšæ³¨å†Œä¸­å¿ƒäº†**



## ä¸ƒã€Consul ä»£æ›¿ Eureka

zookeeperå¯ä»¥ç”¨ï¼Œä½†æ˜¯ç”¨çš„å°‘ã€‚å¦‚æœæ²¡æœ‰ alibaba çš„ Nacosï¼Œé‚£è¿™ä¸ªåŸºæœ¬å°±æ˜¯ Eureka çš„æ¥ç­äºº



## å…«ã€ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹

###### ==CAPï¼š==

> CAP ç†è®ºå’Œ BASE ç†è®ºæ˜¯åˆ†å¸ƒå¼é¢†åŸŸéå¸¸éå¸¸é‡è¦çš„ä¸¤ä¸ªç†è®ºã€‚ä¸å¤¸å¼ åœ°è¯´ï¼Œåªè¦é—®åˆ°åˆ†å¸ƒå¼ç›¸å…³çš„å†…å®¹ï¼Œé¢è¯•å®˜å‡ ä¹æ˜¯å¿…å®šä¼šé—®è¿™ä¸¤ä¸ªåˆ†å¸ƒå¼ç›¸å…³çš„ç†è®ºã€‚
>
> ä¸è®ºæ˜¯ä½ é¢è¯•ä¹Ÿå¥½ï¼Œå·¥ä½œä¹Ÿç½¢ï¼Œéƒ½éå¸¸æœ‰å¿…è¦å°†è¿™ä¸¤ä¸ªç†è®ºææ‡‚ï¼Œå¹¶ä¸”èƒ½å¤Ÿç”¨è‡ªå·±çš„ç†è§£ç»™åˆ«äººè®²å‡ºæ¥ã€‚
>
> æˆ‘è¿™é‡Œå°±ä¸å¤šæè¿™ä¸¤ä¸ªç†è®ºäº†ï¼Œä¸äº†è§£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥çœ‹æˆ‘å‰æ®µæ—¶é—´å†™è¿‡çš„ä¸€ç¯‡ç›¸å…³çš„æ–‡ç« ï¼š[ã€ŠCAP å’Œ BASE ç†è®ºäº†è§£ä¹ˆï¼Ÿå¯ä»¥ç»“åˆå®é™…æ¡ˆä¾‹è¯´ä¸‹ä¸ï¼Ÿã€‹](https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247495298&idx=1&sn=965be0f54ab44bda818656db1f21a39f&chksm=cea1a149f9d6285f1169413ab7663ca2a9c1a8440a5ae5816566eb66b20e4d86f5db1002f66c&token=657875872&lang=zh_CN#rd) ã€‚

- `Cï¼šConsistency (å¼ºä¸€è‡´æ€§)ï¼š`
  - è¯¥ç‰¹æ€§æ˜¯æŒ‡æ‰€æœ‰èŠ‚ç‚¹åœ¨ç›¸åŒæ—¶åˆ»çš„æ•°æ®å®Œå…¨ä¸€è‡´ï¼ˆå¿½ç•¥ç½‘ç»œå»¶è¿Ÿï¼Œç†æƒ³çš„åŒæ—¶åˆ»æ•°æ®ä¸€è‡´æ€§æ— æ³•å®ç°ï¼‰ã€‚ ä¸€è‡´æ€§å¯ä»¥æ ¹æ®ä¸€è‡´çš„ç¨‹åº¦åˆ’åˆ†ä¸ºå¼ºä¸€è‡´æ€§ï¼Œå¼±ä¸€è‡´æ€§ï¼Œæœ€ç»ˆä¸€è‡´æ€§ã€‚
  - Myï¼šAå¥½å®ç°ï¼ŒCè¦æ€ä¹ˆå®ç°ä¿æŒåŒæ­¥å‘¢ï¼Ÿ-> ä¸€äº›ä¸€è‡´æ€§ç®—æ³• ä¾‹å¦‚ [raft ç®—æ³•](http://thesecretlivesofdata.com/raft/)ã€paxos 
  
- `Aï¼šAvailability (å¯ç”¨æ€§)ï¼š`
  - è¯¥ç‰¹æ€§æ˜¯æŒ‡ç³»ç»Ÿä¸ºç”¨æˆ·æä¾›çš„æœåŠ¡å¯ä¸€ç›´ä½¿ç”¨ï¼ˆéå®•æœºèŠ‚ç‚¹ï¼‰ï¼Œä¸ä¼šå‡ºç°ç”¨æˆ·æ“ä½œä¸å…è®¸ç­‰ç”¨æˆ·ä½“éªŒä¸å¥½çš„æƒ…å†µã€‚
  - Myï¼šè¿™ä¸ªå¥½ç†è§£ï¼Œå…¶å®ƒèŠ‚ç‚¹éƒ½æ˜¯åŒæ­¥å¥½çš„æ•°æ®8 ä½†æœ‰ä¸ªèŠ‚ç‚¹è¿˜æ²¡åŒæ­¥å¥½æ˜¯7 åˆ«äººè®¿é—®äº†å°±è®¿é—®äº†ã€‚è¿™ä¸ªå¥½å®ç°
  - `BASE ç†è®º` æ˜¯å¯¹ CAP ç†è®ºçš„å»¶ä¼¸ï¼ˆ**æ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯å¯¹ CAP ä¸­ AP æ–¹æ¡ˆçš„ä¸€ä¸ªè¡¥å……**ï¼‰ï¼Œæ€æƒ³æ˜¯å³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼ˆCAP çš„ä¸€è‡´æ€§å°±æ˜¯å¼ºä¸€è‡´æ€§ï¼‰ï¼Œä½†å¯ä»¥é‡‡ç”¨é€‚å½“çš„é‡‡å–å¼±ä¸€è‡´æ€§ï¼Œå³æœ€ç»ˆä¸€è‡´æ€§ã€‚
  
- `Pï¼šPartition tolerance ï¼ˆåˆ†åŒºå®¹é”™æ€§)ï¼š`
  - åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ç½‘ç»œæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ï¼Œé™¤éæ•´ä¸ªç½‘ç»œç¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœã€‚

**æˆ‘å¯ä»¥ç†è§£ä¸ºï¼šCAPæ˜¯ä¸€ç§ç†è®ºï¼Œå…·ä½“è½åœ°å®ç°æ˜¯raftç®—æ³•æ˜¯Cç†è®ºçš„è§£å†³æ–¹æ¡ˆï¼ŒBASEæ˜¯Açš„è§£å†³æ–¹æ¡ˆå—     Rightï¼**



> ==åæ¥è¡¥å……ï¼šæ··æ·†ç‚¹==
>
> **ä»€ä¹ˆæ˜¯ç½‘ç»œåˆ†åŒºï¼Ÿ**
>
> > åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹å‰çš„ç½‘ç»œæœ¬æ¥æ˜¯è¿é€šçš„ï¼Œä½†æ˜¯å› ä¸ºæŸäº›æ•…éšœï¼ˆæ¯”å¦‚éƒ¨åˆ†èŠ‚ç‚¹ç½‘ç»œå‡ºäº†é—®é¢˜ï¼‰æŸäº›èŠ‚ç‚¹ä¹‹é—´ä¸è¿é€šäº†ï¼Œæ•´ä¸ªç½‘ç»œå°±åˆ†æˆäº†å‡ å—åŒºåŸŸï¼Œè¿™å°±å«ç½‘ç»œåˆ†åŒºã€‚
>
> ![å›¾ç‰‡](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202309071730848.png)
>
> Questionï¼šæ—¢ç„¶ç½‘ç»œéƒ½åˆ†åŒºäº†ä¸ºä»€ä¹ˆè¿˜èƒ½ä¿æŒCP
>
> Anserï¼šå¦‚æœä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‘ç”Ÿç½‘ç»œåˆ†åŒºæ—¶é€‰æ‹©ä¿æŒä¸€è‡´æ€§ï¼ˆCPï¼‰ï¼Œé‚£ä¹ˆåœ¨åˆ†åŒºæœŸé—´ï¼Œç³»ç»Ÿå°†æ‹’ç»å¯¹å¤„äºåˆ†åŒºä¸­çš„èŠ‚ç‚¹çš„è¯»å†™è¯·æ±‚ï¼Œä»¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚è¿™æ„å‘³ç€åˆ†åŒºä¸­çš„èŠ‚ç‚¹å°†æ— æ³•æä¾›æœåŠ¡ï¼Œå› ä¸ºå®ƒä»¬æ— æ³•è¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚ç³»ç»Ÿä¼šç­‰å¾…åˆ†åŒºè§£å†³åï¼Œå†ç»§ç»­æä¾›æœåŠ¡ï¼Œä»¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚
>
> ### ä¸æ˜¯æ‰€è°“çš„â€œ3 é€‰ 2â€
>
> åœ¨ç³»ç»Ÿå‘ç”Ÿâ€œåˆ†åŒºâ€çš„æƒ…å†µä¸‹ï¼ŒCAP ç†è®ºåªèƒ½æ»¡è¶³ CP æˆ–è€… APã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„å‰ææ˜¯ç³»ç»Ÿå‘ç”Ÿäº†â€œåˆ†åŒºâ€
>
> ==å¦‚æœç³»ç»Ÿæ²¡æœ‰å‘ç”Ÿâ€œåˆ†åŒºâ€çš„è¯ï¼ŒèŠ‚ç‚¹é—´çš„ç½‘ç»œè¿æ¥é€šä¿¡æ­£å¸¸çš„è¯ï¼Œä¹Ÿå°±ä¸å­˜åœ¨ P äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŒæ—¶ä¿è¯ C å’Œ A äº†ã€‚==
>
> å› æ­¤ï¼ŒAP æ–¹æ¡ˆåªæ˜¯åœ¨ç³»ç»Ÿå‘ç”Ÿåˆ†åŒºçš„æ—¶å€™æ”¾å¼ƒä¸€è‡´æ€§ï¼Œè€Œä¸æ˜¯æ°¸è¿œæ”¾å¼ƒä¸€è‡´æ€§ã€‚åœ¨åˆ†åŒºæ•…éšœæ¢å¤åï¼Œç³»ç»Ÿåº”è¯¥è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚è¿™ä¸€ç‚¹å…¶å®å°±æ˜¯ BASE ç†è®ºå»¶ä¼¸çš„åœ°æ–¹ã€‚



raftç®—æ³•ï¼šraftæ˜¯ä¸€ç§åè®®

* ä»»ä½•èŠ‚ç‚¹æœ‰3çŠ¶æ€ï¼Œleaderï¼ˆé¢†å¯¼ï¼‰ï¼Œfollowerï¼ˆè·Ÿéšï¼‰ï¼Œcandidateï¼ˆå€™é€‰ï¼‰
* é¢†å¯¼é€‰ä¸¾ï¼šå¿…é¡»é€‰å‡ºä¸€ä¸ªå”¯ä¸€çš„leaderï¼Œä¸ç„¶è¦ä¸€ç›´æŠ•ç¥¨
* æ—¥å¿—å¤åˆ¶ï¼šåœ¨å¿ƒè·³æ—¶é—´çš„æ—¶å€™å‘é€



==BASEï¼š==

* åŸºæœ¬å¯ç”¨ï¼ˆ`B`asically `A`vailableï¼‰
  * åŸºæœ¬å¯ç”¨æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼ˆä¾‹å¦‚å“åº”æ—¶é—´ã€åŠŸèƒ½ä¸Šçš„å¯ç”¨æ€§ï¼‰ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŸºæœ¬å¯ç”¨ç»ä¸ç­‰ä»·äºç³»ç»Ÿä¸å¯ç”¨ã€‚
    * å“åº”æ—¶é—´ä¸Šçš„æŸå¤±ï¼šæ­£å¸¸æƒ…å†µä¸‹æœç´¢å¼•æ“éœ€è¦åœ¨ 0.5 ç§’ä¹‹å†…è¿”å›ç»™ç”¨æˆ·ç›¸åº”çš„æŸ¥è¯¢ç»“æœï¼Œä½†ç”±äºå‡ºç°æ•…éšœï¼ˆæ¯”å¦‚ç³»ç»Ÿéƒ¨åˆ†æœºæˆ¿å‘ç”Ÿæ–­ç”µæˆ–æ–­ç½‘æ•…éšœï¼‰ï¼ŒæŸ¥è¯¢ç»“æœçš„å“åº”æ—¶é—´å¢åŠ åˆ°äº† 1~2 ç§’ã€‚
    * åŠŸèƒ½ä¸Šçš„æŸå¤±ï¼šè´­ç‰©ç½‘ç«™åœ¨è´­ç‰©é«˜å³°ï¼ˆå¦‚åŒåä¸€ï¼‰æ—¶ï¼Œä¸ºäº†ä¿æŠ¤ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§é¡µé¢ã€‚
* è½¯çŠ¶æ€ï¼ˆ`S`oft Stateï¼‰
  * è½¯çŠ¶æ€æ˜¯æŒ‡å…è®¸ç³»ç»Ÿå­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œè€Œè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ã€‚åˆ†å¸ƒå¼å­˜å‚¨ä¸­ä¸€èˆ¬ä¸€ä»½æ•°æ®ä¼šæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œå…è®¸ä¸åŒå‰¯æœ¬åŒæ­¥çš„å»¶æ—¶å°±æ˜¯è½¯çŠ¶æ€çš„ä½“ç°ã€‚mysql replication çš„å¼‚æ­¥å¤åˆ¶ä¹Ÿæ˜¯ä¸€ç§ä½“ç°ã€‚
* æœ€ç»ˆä¸€è‡´æ€§ï¼ˆ`E`ventual Consistencyï¼‰
  * å‡å¦‚Gulimallè®¢å•æœåŠ¡æ‰å…¶å®ƒä¸šåŠ¡éƒ½å›æ»šäº†ï¼Œä½†è®¢å•å´åˆ›å»ºäº†ï¼ˆæœ¬æ¥ä¸è¯¥æœ‰ï¼‰ã€‚åé¢å¯ä»¥åˆ©ç”¨ä¸€äº›æ‰‹æ®µæ ¡éªŒå®ƒä¸è¯¥å­˜åœ¨å¹¶åˆ äº†å®ƒ



[åˆ†å¸ƒå¼äº‹åŠ¡å‡ ç§æ–¹æ¡ˆ](../03ã€æœ¬åœ°äº‹åŠ¡&åˆ†å¸ƒå¼äº‹åŠ¡.pdf)



CAPç†è®ºçš„æ ¸å¿ƒæ˜¯ï¼š**ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶å¾ˆå¥½çš„æ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªéœ€æ±‚**ã€‚

> Q: **ä¸ºä»€ä¹ˆä¸èƒ½åŒæ—¶æ»¡è¶³3ä¸ª**
>
> A: [\+ å¦‚æœä¸æ”¯æŒPï¼Œé‚£ä¹ˆå°±æ— åˆ†å¸ƒå¼æ¦‚å¿µäº†ã€‚
>   \+ ç”¨æˆ·å‘èŠ‚ç‚¹1å†™å…¥ä¸€ä¸ªå€¼ï¼ŒèŠ‚ç‚¹2ç”±äºåˆ†åŒºæ— æ³•æ›´æ–°è¯¥å€¼ï¼Œé‚£ä¹ˆæ•°æ®å°±ä¸ä¸€è‡´ã€‚](https://zhuanlan.zhihu.com/p/355972182)
>
> è¿™ä¸€ç‚¹ç®€è€Œè¨€ä¹‹ï¼šç³»ç»Ÿä¸­çš„æŸä¸ªèŠ‚ç‚¹åœ¨è¿›è¡Œå†™æ“ä½œã€‚ä¸ºäº†ä¿è¯ Cï¼Œ å¿…é¡»è¦**ç¦æ­¢å…¶ä»–èŠ‚ç‚¹çš„è¯»å†™æ“ä½œ**ï¼Œè¿™å°±å’Œ A å‘ç”Ÿå†²çªäº†ã€‚



>Q:  **æ²¡æœ‰å‘ç”Ÿç½‘ç»œåˆ†åŒºæ—¶å€™ï¼Œç³»ç»Ÿåº”è¯¥é€‰æ‹©ä»€ä¹ˆç‰¹æ€§ï¼Ÿ**
>A: \+ å…¶å®æ­£å¸¸æƒ…å†µä¸‹éƒ½ä¸ä¼šå‘ç”Ÿç½‘ç»œåˆ†åŒºï¼Œé‚£ä¹ˆç³»ç»Ÿè®¾è®¡çš„æ—¶å€™éœ€è¦è€ƒè™‘åˆ°æ»¡è¶³CAç‰¹æ€§ï¼Œåªæœ‰å½“ç³»ç»Ÿå‘ç”Ÿåˆ†åŒºæ—¶å€™ï¼Œæ ¹æ®åœºæ™¯ç‰¹æ€§é€‰æ‹©CPæˆ–è€…AP



>Q: **å…³äº P çš„ç†è§£**
>
>A: [ç°å®æƒ…å†µä¸‹æˆ‘ä»¬é¢å¯¹çš„æ˜¯ä¸€ä¸ªä¸å¯é çš„ç½‘ç»œ - > ç½‘ç»œä¸¢åŒ…ã€æœ‰ä¸€å®šæ¦‚ç‡å®•æœºçš„è®¾å¤‡ - > èŠ‚ç‚¹å®•æœºï¼Œè¿™ä¸¤ä¸ªå› ç´ éƒ½ä¼šå¯¼è‡´Partitionï¼Œå› è€Œåˆ†å¸ƒå¼ç³»ç»Ÿå®ç°ä¸­ P æ˜¯ä¸€ä¸ªå¿…é¡»é¡¹ï¼Œè€Œä¸æ˜¯å¯é€‰é¡¹](http://www.mamicode.com/info-detail-1263729.html)ï¼ˆç°å®ç”Ÿæ´»ä¸­æˆ‘ä»¬æ²¡åŠæ³•ä¿è¯ç½‘ç»œä¸ä¸­æ–­ç½‘çº¿ä¸ä¼šæ–­ï¼Œé™¤éå•å°æœºå™¨CAè‡ªå·±æœ¬åœ°è®¿é—®è‡ªå·±localhostä½†ä¸å¯èƒ½ï¼‰
>
>é‡åˆ°æŸä¸ªèŠ‚ç‚¹æˆ–ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œé›†ç¾¤ä¸‹ä»ç„¶æœ‰èŠ‚ç‚¹èƒ½å¤ŸæŒç»­æä¾›æœåŠ¡ï¼ˆæœåŠ¡ï¼šæœåŠ¡åªèƒ½åœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¹‹é—´å–èˆï¼‰

å› æ­¤ï¼Œæ ¹æ®CAPåŸç†å°†NoSQLæ•°æ®åº“åˆ†æˆäº†æ»¡è¶³CAåŸåˆ™ã€æ»¡è¶³CPåŸåˆ™å’Œæ»¡è¶³APåŸåˆ™ä¸‰å¤§ç±»:

![img](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202205301552992.png)

APæ¶æ„ï¼ˆEurekaï¼‰

![img](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202205301552994.png)

CPæ¶æ„ï¼ˆZooKeeper/Consulï¼‰

![img](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202205301552734.png)



## ==------æœåŠ¡è°ƒç”¨------==

## ä¸€ã€Ribbonâœ”

### 1. å‰è¨€

> Spring Cloud Ribbonæ˜¯åŸºäºNetflix Ribbonå®ç°çš„ä¸€å¥— **==å®¢æˆ·ç«¯==è´Ÿè½½å‡è¡¡çš„å·¥å…·**ã€‚
>
> è´Ÿè½½å‡è¡¡ + RestTemplateè°ƒç”¨

ä¸»è¦åŠŸèƒ½æ˜¯æä¾› **å®¢æˆ·ç«¯çš„è½¯ä»¶è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨**ã€‚

Ribbonç›®å‰ä¹Ÿè¿›å…¥ç»´æŠ¤æ¨¡å¼ã€‚

Ribbonæœªæ¥å¯èƒ½è¢«Spring Cloud LoadBalaceræ›¿ä»£ã€‚



> Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯VS NginxæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡åŒºåˆ«

Nginxæ˜¯æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼Œå®¢æˆ·ç«¯æ‰€æœ‰è¯·æ±‚éƒ½ä¼šäº¤ç»™nginxï¼Œç„¶åç”±nginxå®ç°è½¬å‘è¯·æ±‚ã€‚å³è´Ÿè½½å‡è¡¡æ˜¯ç”±æœåŠ¡ç«¯å®ç°çš„ã€‚
Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡ï¼Œåœ¨è°ƒç”¨å¾®æœåŠ¡æ¥å£æ—¶å€™ï¼Œä¼šåœ¨æ³¨å†Œä¸­å¿ƒä¸Šè·å–æ³¨å†Œä¿¡æ¯æœåŠ¡åˆ—è¡¨ä¹‹åç¼“å­˜åˆ° JVM æœ¬åœ°ï¼Œä»è€Œåœ¨æœ¬åœ°å®ç°RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æŠ€æœ¯ã€‚



### 2. Ribbonçš„è´Ÿè½½å‡è¡¡å’ŒRestè°ƒç”¨

```xml
spring-cloud-starter-netflix-eureka-server
spring-cloud-starter-netflix-ribbon

å…ˆå‰å·¥ç¨‹é¡¹ç›®æ²¡æœ‰å¼•å…¥spring-cloud-starter-ribbonä¹Ÿå¯ä»¥ä½¿ç”¨ribbonã€‚
è¿™æ˜¯å› ä¸ºspring-cloud-starter-netflix-eureka-clientè‡ªå¸¦äº†spring-cloud-starter-ribbonå¼•ç”¨ã€‚
```

å‰é¢æµ‹è¯•çš„æ—¶å€™ï¼Œ8001ã€8002 é»˜è®¤çš„æ˜¯ **è½®è¯¢** è´Ÿè½½è®¿é—®ï¼Œæœ‰ 7 å¤§è´Ÿè½½ç®—æ³•



### 3. Ribbonè´Ÿè½½è§„åˆ™æ›¿æ¢

1.ä¿®æ”¹cloud-consumer-order80

2.æ³¨æ„é…ç½®ç»†èŠ‚

å®˜æ–¹æ–‡æ¡£æ˜ç¡®ç»™å‡ºäº†è­¦å‘Š:

**è¿™ä¸ªè‡ªå®šä¹‰é…ç½®ç±»ä¸èƒ½æ”¾åœ¨@ComponentScanæ‰€æ‰«æçš„å½“å‰åŒ…ä¸‹ä»¥åŠå­åŒ…ä¸‹**ï¼Œ

å¦åˆ™æˆ‘ä»¬è‡ªå®šä¹‰çš„è¿™ä¸ªé…ç½®ç±»å°±ä¼šè¢«æ‰€æœ‰çš„Ribbonå®¢æˆ·ç«¯æ‰€å…±äº«ï¼Œè¾¾ä¸åˆ°ç‰¹æ®ŠåŒ–å®šåˆ¶çš„ç›®çš„äº†ã€‚

ä¹Ÿå°±æ˜¯è¯´ä¸è¦å’Œå¯åŠ¨ç±»ä¸€ä¸ªåŒ…è·¯å¾„



æˆ‘è¿™é‡Œ

```java
@RibbonClient(name = "cloud-payment-service", configuration = MySelfRule.class)
name æˆ‘æ˜¯å°å†™æ‰ç”Ÿæ•ˆ ï¼ï¼ï¼
```



**æ‰‹å†™è½®è¯¢ç®—æ³•ï¼Œè‡ªå·±å¢ƒç•Œæ²¡åˆ° å…ˆæ¬ ç€ï¼**

åˆ°æ—¶å€™ä¼°è®¡å¾—è¿˜å€º



## äºŒã€OpenFeignâœ”

### 1. OpenFeignæœåŠ¡è°ƒç”¨

> è”æƒ³ï¼šRPCæ€ä¹ˆå¤„ç†å¹‚ç­‰ã€é‡è¯•çš„æƒ…å†µ ã€è¿™å°±æ˜¯ä½ ç”¨æ²¡ç”¨è¿‡RPCçš„è€ƒé‡ç‚¹ã€‘
>
> processRequest() ç”¨ redis çš„ setnx ä¿è¯å¹‚ç­‰
>
> ```java
> public class IdempotentRetryService {
>     private final IdempotentService idempotentService = new IdempotentService();
>     private static final int MAX_RETRIES = 5;
>     private static final long INITIAL_INTERVAL = 1000L; // 1ç§’
> 
>     public Response processRequestWithRetry(String requestId, Request request) {
>         int attempts = 0;
>         long interval = INITIAL_INTERVAL;
> 
>         while (attempts < MAX_RETRIES) {
>             try {
>                 return idempotentService.processRequest(requestId, request);
>             } catch (Exception e) {
>                 attempts++;
>                 if (attempts >= MAX_RETRIES) {
>                     throw new RuntimeException("æœ€å¤§é‡è¯•æ¬¡æ•°è¾¾åˆ°ï¼Œæ“ä½œå¤±è´¥", e);
>                 }
>                 try {
>                     Thread.sleep(interval);
>                 } catch (InterruptedException ie) {
>                     Thread.currentThread().interrupt();
>                 }
>                 interval *= 2; // æŒ‡æ•°é€€é¿
>             }
>         }
>         throw new RuntimeException("æ“ä½œå¤±è´¥");
>     }
> }
> ```

> **TODOï¼šå°±ç®—é…äº†è¶…æ—¶æ—¶é—´ ç¬¬ä¸€æ¬¡è·‘ä¹Ÿè€æ˜¯è¶…æ—¶ï¼Œåé¢å°±ä¸ä¼šäº†**
> è¿™æ˜¯ç”±äºåœ¨è°ƒç”¨å…¶ä»–å¾®æœåŠ¡æ¥å£å‰ï¼Œä¼šå»è¯·æ±‚è¯¥å¾®æœåŠ¡çš„ç›¸å…³ä¿¡æ¯(åœ°å€ã€ç«¯å£ç­‰)ï¼Œå¹¶åšä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œç”±äºé»˜è®¤çš„[æ‡’åŠ è½½](https://so.csdn.net/so/search?q=æ‡’åŠ è½½&spm=1001.2101.3001.7020)ç‰¹æ€§ï¼Œå¯¼è‡´äº†åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼Œå‡ºç°è¶…æ—¶çš„æƒ…å†µ    **è§£å†³ï¼šRibboné…ç½®é¥¥é¥¿åŠ è½½ï¼ˆæœ€ä½³ï¼‰**
>
> **æ³¨æ„**: Feign æ˜¯æ•´åˆè¿›äº† Ribbon çš„ï¼Œå¤©ç”Ÿå¸¦ç€ä»–       Feignæ˜¯åŸºäºHTTPå®¢æˆ·ç«¯çš„å£°æ˜å¼WebæœåŠ¡å®¢æˆ·ç«¯ 
>
> ä»¥å‰æ˜¯: Ribbon+RestTemplate   ä¸€å¥—æ¨¡ç‰ˆåŒ–çš„è°ƒç”¨æ–¹æ³•
>
> ç°åœ¨ç”¨ OpenFeign å®šä¹‰ä¸€ä¸ª @FeignClient("æœåŠ¡å") åˆ°æ¥å£å°±è¡Œï¼Œåƒ @Mapper çš„æ„Ÿè§‰ä¸€æ ·  ->  æ¥å£ + æ³¨è§£



ä»¥å‰è¦æä¸€ä¸ªé…ç½®ç±»@LoadBalancedè¿”å›ä¸€ä¸ªRestTemplateçš„Bean          ç„¶åControllerå†ç”¨è¿™ä¸ªrestTemplate Bean

ç°åœ¨ Service æ¥å£å®šä¹‰ä¸€ä¸ª @FeignClient æ³¨è§£ æŒ‡å‘æœåŠ¡æä¾›è€…payment      å°±å¯ä»¥ç›´æ¥åœ¨æœ¬80è°ƒç”¨8001çš„ï¼ˆä¹Ÿå°±æ˜¯æŒ‡å‘æœåŠ¡æä¾›è€…çš„ä¸œè¥¿ï¼‰



æ€»ç»“ï¼šæƒ³è¦è¿œç¨‹è°ƒç”¨åˆ«çš„æœåŠ¡ 

1ï¼‰ã€å¼•å…¥open-feign   

2ï¼‰ã€ç¼–å†™ä¸€ä¸ªæ¥å£ï¼Œå‘Šè¯‰ SpringCloud è¿™ä¸ªæ¥å£éœ€è¦è°ƒç”¨è¿œç¨‹æœåŠ¡

â€‹	1ã€å£°æ˜æ¥å£çš„æ¯ä¸€ä¸ªæ–¹æ³•éƒ½æ˜¯è°ƒç”¨å“ªä¸ªè¿œç¨‹æœåŠ¡çš„å“ªä¸ªè¯·æ±‚

3ï¼‰ã€å¼€å¯è¿œç¨‹è°ƒç”¨åŠŸèƒ½ï¼Œåœ¨ä¸»å¯åŠ¨ç±»åŠ  @EnableFeignClients

```java
/**
  * è¿™æ˜¯ä¸€ä¸ªå£°æ˜å¼çš„è¿œç¨‹è°ƒç”¨
  */
@FeignClient("gulimall-coupon")
public interface CouponFeignService {
    //ä» gulimall-coupon ä¸­æ‰¾ /coupon/coupon/member/list è¿™ä¸ªæ–¹æ³•
    @RequestMapping("/coupon/coupon/member/list")
    public R memberCoupons();
}

//ä¸»å¯åŠ¨ç±»
@EnableFeignClients("com.zzq.gulimall.member.feign")


===============================è‡ªå·±è¿™è¾¹çš„ Model ä¸šåŠ¡è°ƒç”¨å¤„ç†
    @Autowired
    CouponFeignService couponFeignService;
    /**
     * DIY
     */
    @RequestMapping("/coupons")
    public R RPCTest(){
        MemberEntity memberEntity = new MemberEntity();
        memberEntity.setNickname("å¼ ä¸‰");
		// Here
        R r = couponFeignService.memberCoupons();
        return R.ok().put("member",memberEntity).put("coupons",r.get("coupons"));
    }
```





### 2. OpenFeignè¶…æ—¶æ§åˆ¶

> **OpenFeigné»˜è®¤ç­‰å¾…1ç§’é’Ÿï¼Œè¶…è¿‡åæŠ¥é”™**
>
> å®¢æˆ·ç«¯åªç­‰1ç§’é’Ÿï¼ŒæœåŠ¡ç«¯è¶…è¿‡äº†1ç§’é’Ÿ

åœºæ™¯ï¼šæ•…æ„æŠŠæœåŠ¡çš„æä¾›è€… 8001 ç«¯ä¸šåŠ¡è®¾æˆè€—è´¹3ç§’é’Ÿï¼Œè¯æ˜ä¸Šé¢é—®é¢˜ï¼Œè¿™æ—¶å®¢æˆ·ç«¯å°±ä¼šæŠ¥é”™ï¼

```java
java.net.SocketTimeoutException: Read timed out
```

**YMLæ–‡ä»¶é‡Œéœ€è¦å¼€å¯OpenFeignå®¢æˆ·ç«¯è¶…æ—¶æ§åˆ¶**

æ³¨æ„ï¼šç›´æ¥ç”¨å°±è¡Œ,è¿™åªæ˜¯==ideaä¸ç»™æç¤º==,ä¸å½±å“æ•ˆæœ

```yaml
#è®¾ç½®feignå®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´(OpenFeigné»˜è®¤æ”¯æŒribbon)(å•ä½ï¼šæ¯«ç§’)
ribbon:
  #æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹,ä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´
  ReadTimeout: 60000
  #æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´
  ConnectTimeout: 60000
```



### 3. OpenFeignæ—¥å¿—å¢å¼º

1. config ä¸­æ³¨å†Œä¸€ä¸ª Beanï¼ˆLogger.Levelï¼‰
2. yaml ä¸­é…ç½®feignæ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£





### 4.è¡¥å……ï¼šGuliMall

#### 4.1.æºç 

1. æ„é€ è¯·æ±‚æ•°æ®ï¼Œå°†å¯¹è±¡è½¬ä¸ºjsonï¼›
      RequestTemplate template = buildTemplateFromArgs,createï¼ˆargvï¼‰ï¼›
      
2. å‘é€è¯·æ±‚è¿›è¡Œæ‰§è¡Œï¼ˆæ‰§è¡ŒæˆåŠŸä¼šè§£ç å“åº”æ•°æ®ï¼‰ï¼š
      executeAndDecodeï¼ˆtemplateï¼‰ï¼›

3. æ‰§è¡Œè¯·æ±‚ä¼šæœ‰é‡è¯•æœºåˆ¶

   ```java
   while(true) {
   try {
   	return this.executeAndDecode(template);
   }catch (RetryableException var8) {
       xxx
   	retryer.continueOrPropagate(e);
   }
   	continue;
   }
   ```




#### 4.2.é—®é¢˜

Feignè¿œç¨‹è°ƒç”¨ä¸¢å¤±è¯·æ±‚å¤´ï¼šè®¢å•æ¨¡å—çš„ Feign æºç ä¼šè‡ªåŠ¨åˆ› Request å¯¼è‡´ä¸¢å¤± Cookieã€‚è€Œåº•å±‚è‡ªåˆ›çš„æ—¶å€™ç”¨åˆ°æ‹¦æˆªå™¨å¢å¼ºï¼ˆå³DIY				ä¸ªæ‹¦æˆªå™¨æŠŠåŸRequset Cookieæ”¾æ–°Requestï¼‰    è§£å†³é‡ç‚¹ï¼šSpringç±» `RequestContextHolder`





è¡¥å……æˆ‘çš„é—®é¢˜ï¼š

> openfeignä¼šæœ‰ä¸¢å¤±è¯·æ±‚å¤´çš„æƒ…å†µæ˜¯å› ä¸ºå®ƒæ˜¯åŸºäºhttpè¯·æ±‚ï¼Œè€Œhttpè¯·æ±‚åˆæ˜¯æ— çŠ¶æ€åè®®çš„åŸå› å—

OpenFeignæ˜¯ä¸€ä¸ªåŸºäºHTTPåè®®çš„Java HTTPå®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ–HTTP APIçš„è°ƒç”¨ã€‚å®ƒä¸ä¼šå¯¼è‡´ä¸¢å¤±è¯·æ±‚å¤´çš„æƒ…å†µï¼Œå› ä¸ºHTTPè¯·æ±‚å¤´æ˜¯åœ¨æ¯ä¸ªè¯·æ±‚ä¸­æ˜ç¡®å‘é€çš„ï¼Œæ— è®ºæ˜¯ä½¿ç”¨OpenFeignè¿˜æ˜¯å…¶ä»–HTTPå®¢æˆ·ç«¯åº“ã€‚

**HTTPåè®®æœ¬èº«æ˜¯æ— çŠ¶æ€çš„ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„**ï¼ŒæœåŠ¡å™¨ä¸ä¼šä¿ç•™ä»»ä½•å…³äºå®¢æˆ·ç«¯çš„çŠ¶æ€ä¿¡æ¯ã€‚ä½†æ˜¯ï¼ŒHTTPåè®®å…è®¸åœ¨è¯·æ±‚å¤´ä¸­å‘é€çŠ¶æ€ä¿¡æ¯ï¼Œä»¥ä¾¿æœåŠ¡å™¨å¯ä»¥äº†è§£å®¢æˆ·ç«¯çš„çŠ¶æ€ã€‚è¿™äº›çŠ¶æ€ä¿¡æ¯å¯ä»¥åŒ…æ‹¬è®¤è¯ä»¤ç‰Œã€ä¼šè¯IDã€è¯·æ±‚å‚æ•°ç­‰ã€‚

OpenFeignå¯ä»¥é€šè¿‡è®¾ç½®è¯·æ±‚å¤´æ¥å‘é€è¿™äº›çŠ¶æ€ä¿¡æ¯ï¼Œä»¥ä¾¿æœåŠ¡å™¨å¯ä»¥äº†è§£å®¢æˆ·ç«¯çš„çŠ¶æ€ã€‚å¦‚æœè¯·æ±‚å¤´åœ¨OpenFeignä¸­ä¸¢å¤±ï¼Œå¯èƒ½æ˜¯ç”±äºOpenFeigné…ç½®ä¸æ­£ç¡®æˆ–ç”±äºç½‘ç»œé—®é¢˜å¯¼è‡´çš„ã€‚ä½†è¿™å¹¶ä¸æ˜¯HTTPåè®®æœ¬èº«çš„é™åˆ¶ï¼Œè€Œæ˜¯å®¢æˆ·ç«¯çš„å®ç°é—®é¢˜ã€‚



## ==------æœåŠ¡é™çº§------==

## ä¸€ã€Hystrix Ã—

> è±ªçŒªå“¥å‡ºé“å³å·…å³°ï¼Œåé¢é‚£äº›éƒ½æœ‰æŠ„å®ƒçš„å€Ÿé‰´å®ƒçš„ç†å¿µã€‚å®˜ç½‘æ¨èç”¨ resilience4j ä½†è¿™é‡Œæ˜¯ä¸­å›½ï¼Œè¨€å¤–ä¹‹æ„å°±æ˜¯æ²¡æœ‰ç”¨è¿™ä¸ªï¼Œéƒ½ä¼šå‘Alibabaé æ‹¢ï¼
>
> å­¦ä¹ ç†å¿µè®¾è®¡å’Œæ€æƒ³ï¼ŒAlibaba sentinelåé¢éƒ½æ˜¯ä¸€äº›ç»†èŠ‚å’Œé…ç½®ï¼ˆå¤©ä¸‹æ–‡ç« ä¸€å †æŠ„ï¼‰

**æœåŠ¡é›ªå´©**

å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´è°ƒç”¨çš„æ—¶å€™ï¼Œå‡è®¾å¾®æœåŠ¡Aè°ƒç”¨å¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cï¼Œå¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cåˆè°ƒç”¨å…¶å®ƒçš„å¾®æœåŠ¡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œæ‰‡å‡ºâ€ã€‚**å¦‚æœæ‰‡å‡ºçš„é“¾è·¯ä¸ŠæŸä¸ªå¾®æœåŠ¡çš„è°ƒç”¨å“åº”æ—¶é—´è¿‡é•¿æˆ–è€…ä¸å¯ç”¨ï¼Œå¯¹å¾®æœåŠ¡Açš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå´©æºƒï¼Œæ‰€è°“çš„â€œé›ªå´©æ•ˆåº”â€.**

**Hystrixæ˜¯ä»€ä¹ˆ**

ç±»ä¼¼ç†”æ–­ä¿é™©ä¸

### 1. é‡è¦æ¦‚å¿µ

* æœåŠ¡é™çº§

  * ä¾‹å¦‚æ‰“10086äººå·¥ï¼Œåå¸­å¿™ç»§ç»­ç­‰å¾…è¯·æŒ‰1æ— éœ€ç­‰å¾…è¯·æŒ‚æœº
  * åœ¨è¿ç»´æœŸé—´ï¼Œå½“ç³»ç»Ÿå¤„äºé«˜å³°æœŸï¼Œç³»ç»Ÿèµ„æºç´§å¼ ï¼Œæˆ‘ä»¬å¯ä»¥**è®©éæ ¸å¿ƒä¸šåŠ¡é™çº§è¿è¡Œã€‚é™çº§ï¼šæŸäº›æœåŠ¡ä¸å¤„ç†ï¼Œæˆ–è€…ç®€å•å¤„ç†**ã€æŠ›å¼‚å¸¸ã€è¿”å›NULLã€è°ƒç”¨ Mock æ•°æ®ã€è°ƒç”¨ Fallback å¤„ç†é€»è¾‘ã€‘ã€‚

* æœåŠ¡ç†”æ–­

  * ä¿é™©ä¸ï¼Œä¸Šé¢æœåŠ¡é™çº§å¯æ²¡åœ
  * è®¾ç½®æœåŠ¡çš„è¶…æ—¶ï¼Œå½“è¢«è°ƒç”¨çš„æœåŠ¡ç»å¸¸å¤±è´¥åˆ°è¾¾æŸä¸ªé˜ˆå€¼ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å¯**æ–­è·¯ä¿æŠ¤æœºåˆ¶**ï¼Œåæ¥çš„è¯·æ±‚ä¸å†å»è°ƒç”¨è¿™ä¸ªæœåŠ¡ã€‚æœ¬åœ°ç›´æ¥è¿”å›é»˜è®¤çš„æ•°æ®

* æœåŠ¡é™æµ

  * ç§’æ€é«˜å¹¶å‘ï¼Œè®©å¤§å®¶æ’é˜Ÿ

  

**å“ªäº›æƒ…å†µä¼šå‡ºå‘é™çº§**

- ç¨‹åºè¿è¡Œå¯¼å¸¸
- è¶…æ—¶
- æœåŠ¡ç†”æ–­è§¦å‘æœåŠ¡é™çº§
- çº¿ç¨‹æ± /ä¿¡å·é‡æ‰“æ»¡ä¹Ÿä¼šå¯¼è‡´æœåŠ¡é™çº§



æ³¨æ„ï¼šSpringBoot é»˜è®¤ç»§æ‰¿çš„æ˜¯ Tomcat ï¼Œtomcatçš„é»˜è®¤çš„å·¥ä½œçº¿ç¨‹æ•°



### 2. æœåŠ¡é™çº§

å…ˆ 8001 å…ˆä»è‡ªèº«æ‰¾é—®é¢˜ **åˆ†ä¸¤æ­¥èµ°:**

1. @Service ä¸­å¯¹æ–¹æ³•é…ç½® @HystrixCommand é‡Œé¢çš„å‚æ•° fallbackMethod æŒ‡å®šå…œåº•çš„æ–¹æ³•
2. ä¸»å¯åŠ¨ç±»æ¿€æ´»  æ·»åŠ æ–°æ³¨è§£@EnableCircuitBreaker

80 å¯ä»¥æ ¹æ® 8001 çš„ä¸€æ ·çš„ä¾è‘«èŠ¦ç”»ç“¢



#### 2.1 è§£å†³ä»£ç è†¨èƒ€é—®é¢˜

ç›®å‰é—®é¢˜1 æ¯ä¸ªä¸šåŠ¡æ–¹æ³•å¯¹åº”ä¸€ä¸ªå…œåº•çš„æ–¹æ³•ï¼Œä»£ç è†¨èƒ€

è§£å†³æ–¹æ³•ï¼šæä¸ª Global çš„æ–¹æ³•ï¼Œé»˜è®¤éƒ½ç”¨è¿™ä¸ª

1:1æ¯ä¸ªæ–¹æ³•é…ç½®ä¸€ä¸ªæœåŠ¡é™çº§æ–¹æ³•ï¼ŒæŠ€æœ¯ä¸Šå¯ä»¥ï¼Œä½†æ˜¯ä¸èªæ˜

1:Né™¤äº†ä¸ªåˆ«é‡è¦æ ¸å¿ƒä¸šåŠ¡æœ‰ä¸“å±ï¼Œå…¶å®ƒæ™®é€šçš„å¯ä»¥é€šè¿‡@DefaultProperties(defaultFallback = â€œâ€)ç»Ÿä¸€è·³è½¬åˆ°ç»Ÿä¸€å¤„ç†ç»“æœé¡µé¢

é€šç”¨çš„å’Œç‹¬äº«çš„å„è‡ªåˆ†å¼€ï¼Œé¿å…äº†ä»£ç è†¨èƒ€ï¼Œåˆç†å‡å°‘äº†ä»£ç é‡



#### 2.2 Hystrixä¹‹é€šé…æœåŠ¡é™çº§FeignFallback

é—®é¢˜ï¼šæœåŠ¡æä¾›è€… 8001 å®•æœºã€**æœåŠ¡é™çº§ï¼Œå®¢æˆ·ç«¯å»è°ƒç”¨æœåŠ¡ç«¯ï¼Œç¢°ä¸ŠæœåŠ¡ç«¯å®•æœºæˆ–å…³é—­**ã€‘

è§£å†³ï¼š80 å®ç°æœåŠ¡é™çº§ @FeignClient fallbackå±æ€§ + æä¾›ä¸€ä¸ª Service çš„å®ç°ç±»ã€æœ¬æ¬¡æ¡ˆä¾‹æœåŠ¡é™çº§å¤„ç†æ˜¯åœ¨å®¢æˆ·ç«¯80å®ç°å®Œæˆçš„ï¼Œä¸æœåŠ¡ç«¯8001æ²¡æœ‰å…³ç³»ï¼Œåªéœ€è¦ä¸º[Feign](https://so.csdn.net/so/search?q=Feign&spm=1001.2101.3001.7020)å®¢æˆ·ç«¯å®šä¹‰çš„æ¥å£æ·»åŠ ä¸€ä¸ªæœåŠ¡é™çº§å¤„ç†çš„å®ç°ç±»å³å¯å®ç°è§£è€¦ã€‘



### 3. æœåŠ¡ç†”æ–­

> ä¸€å®šè¦åŒºåˆ† æœåŠ¡é™çº§ vs æœåŠ¡ç†”æ–­

```java
@HystrixCommand(fallbackMethod = "paymentCircuitBreaker_fallback",commandProperties = {
            @HystrixProperty(name = "circuitBreaker.enabled",value = "true"),// æ˜¯å¦å¼€å¯æ–­è·¯å™¨
            @HystrixProperty(name = "circuitBreaker.requestVolumeThreshold",value = "10"),// è¯·æ±‚æ¬¡æ•°
            @HystrixProperty(name = "circuitBreaker.sleepWindowInMilliseconds",value = "10000"), // æ—¶é—´çª—å£æœŸ
            @HystrixProperty(name = "circuitBreaker.errorThresholdPercentage",value = "60"),// å¤±è´¥ç‡è¾¾åˆ°å¤šå°‘åè·³é—¸
    })
```

æœåŠ¡ç†”æ–­çš„å®ç°æ•ˆæœï¼šæœåŠ¡é™çº§åå…œåº•æ–¹æ³•æ‰§è¡Œäº†å¾ˆå¤šæ¬¡å æ¯”è¯·æ±‚è¶…è¿‡é»˜è®¤10ç§’å†…è¶…è¿‡50%çš„è¯·æ±‚å¤±è´¥ï¼Œè¿™ä¸ªæ—¶å€™å°±ç®—è¯·æ±‚æ­£ç¡®çš„ä¹Ÿä¼šåˆ°å…œåº•çš„é”™è¯¯æ–¹æ³•ä¸Šå³å¼€å¯æ–­è·¯å™¨ï¼ˆè¿‡ä¸€ä¸‹ä¼šæ¢å¤ï¼‰ 

##### æ–­è·¯å™¨å¼€å¯æˆ–è€…å…³é—­çš„æ¡ä»¶

åˆ°è¾¾ä»¥ä¸‹é˜€å€¼ï¼Œæ–­è·¯å™¨å°†ä¼šå¼€å¯ï¼š

å½“æ»¡è¶³ä¸€å®šçš„é˜€å€¼çš„æ—¶å€™ï¼ˆé»˜è®¤10ç§’å†…è¶…è¿‡20ä¸ªè¯·æ±‚æ¬¡æ•°)
å½“å¤±è´¥ç‡è¾¾åˆ°ä¸€å®šçš„æ—¶å€™ï¼ˆé»˜è®¤10ç§’å†…è¶…è¿‡50%çš„è¯·æ±‚å¤±è´¥)
å½“å¼€å¯çš„æ—¶å€™ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¸ä¼šè¿›è¡Œè½¬å‘

ä¸€æ®µæ—¶é—´ä¹‹åï¼ˆé»˜è®¤æ˜¯5ç§’)ï¼Œè¿™ä¸ªæ—¶å€™æ–­è·¯å™¨æ˜¯åŠå¼€çŠ¶æ€ï¼Œä¼šè®©å…¶ä¸­ä¸€ä¸ªè¯·æ±‚è¿›è¡Œè½¬å‘ã€‚å¦‚æœæˆåŠŸï¼Œæ–­è·¯å™¨ä¼šå…³é—­ï¼Œè‹¥å¤±è´¥ï¼Œç»§ç»­å¼€å¯ã€‚

[Hutoolå›½äº§å·¥å…·ç±»](https://hutool.cn/) å¥½åƒè›®ç»™åŠ›

For Example: 

```java
//ç”Ÿæˆçš„UUIDæ˜¯å¸¦-çš„å­—ç¬¦ä¸²ï¼Œç±»ä¼¼äºï¼ša5c8a5e8-df2b-4706-bea4-08d0939410e3
String uuid = IdUtil.randomUUID();

//ç”Ÿæˆçš„æ˜¯ä¸å¸¦-çš„å­—ç¬¦ä¸²ï¼Œç±»ä¼¼äºï¼šb17f24ff026d40949c85a24f4f375d42
String simpleUUID = IdUtil.simpleUUID();
```





#### **4. æœåŠ¡é™æµ** 

åé¢é«˜çº§ç¯‡è®²è§£alibabaçš„Sentinelè¯´æ˜

Alibaba sentinel



#### 5. Hystrixå›¾å½¢åŒ–Dashboardæ­å»º

éœ€è¦è‡ªå·±æ­å»ºä¸€ä¸ªç›‘æ§å¹³å° å³ æ–°å»ºä¸€ä¸ª Model é¡¹ç›® å’Œ Eureka ä¸€æ ·ï¼Œä½† Zookeeper å°±ä¸ç”¨ ï¼

è¿™é‡Œå…¶å®åé¢çš„ Sentinel ä¹Ÿä¸ç”¨å†æ­åŒZookeeper

çœ‹æ—¥å¿—ä¸æ–¹ä¾¿ï¼Œè¶Šæ¥è¶Šåå‘ä»ªè¡¨ç›˜ï¼ˆå›¾å½¢åŒ–çš„ç›‘æ§ï¼Œæ•°æ®æŠ¥è¡¨çš„å±•ç°ï¼‰

```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-hystrix-dashboard</artifactId>
</dependency>
```



## ==------æœåŠ¡ç½‘å…³------==

æŠ€æœ¯é€‰å‹ï¼šä¸€èˆ¬ä¸ä¼šç”¨ zuul äº†ï¼Œéƒ½ç”¨ Gateway

## ä¸€ã€Gatewayâœ”

### 1. å‰è¨€

>zuul æ˜¯ Netflix å…¬å¸å‡ºçš„ï¼ŒSpring å…¬å¸ç­‰ä¸åŠäº†å°±è‡ªå·±å‡ºäº† Gatewayï¼ŒGatewayæ˜¯åŸ zuul1.xç‰ˆçš„æ›¿ä»£
>
>**Cloud å…¨å®¶æ¡¶ä¸­æœ‰ä¸ªå¾ˆé‡è¦çš„ç»„ä»¶å°±æ˜¯ç½‘å…³ï¼**
>
>Nginxé’ˆå¯¹ç”¨æˆ·å’Œå‰ç«¯ï¼Œgatewayé’ˆå¯¹å‰ç«¯å’Œåå°æœåŠ¡

ä¼ ç»Ÿçš„Webæ¡†æ¶ï¼Œæ¯”å¦‚è¯´: Struts2ï¼ŒSpringMVCç­‰éƒ½æ˜¯åŸºäºServlet APlä¸Servletå®¹å™¨åŸºç¡€ä¹‹ä¸Šè¿è¡Œçš„ã€‚

ä½†æ˜¯åœ¨Servlet3.1ä¹‹åæœ‰äº†å¼‚æ­¥éé˜»å¡çš„æ”¯æŒã€‚è€Œ**WebFluxæ˜¯ä¸€ä¸ªå…¸å‹éé˜»å¡å¼‚æ­¥çš„æ¡†æ¶**



**å¾®æœåŠ¡æ¶æ„ä¸­ç½‘å…³çš„ä½ç½®**

>åœºæ™¯ï¼š1å·æœºå™¨çš„7000ç«¯å£æŒ‚æ‰äº†ï¼Œæˆ‘ä¸å¯èƒ½æ‰‹åŠ¨çš„å»ä»£ç æ”¹æˆèƒ½ç”¨çš„2å·æœºå™¨çš„7000ç«¯å£å§
>
>ç¬¬ä¸€ä¸ªéœ€æ±‚ï¼š10å‡ å°åŠå…¶ä¸€èµ·ä¸Šçº¿ï¼Œç»è¿‡ç½‘å…³åŠ¨æ€çš„è·¯ç”±åˆ°èƒ½ç”¨çš„å„ä¸ªæœåŠ¡ï¼Œä¹Ÿèƒ½ä»æ³¨å†Œä¸­å¿ƒä¸­å®æ—¶åœ°æ„ŸçŸ¥æŸä¸ªæœåŠ¡ä¸Šçº¿è¿˜æ˜¯ä¸‹çº¿ã€‚
>
>ç¬¬äºŒä¸ªéœ€æ±‚ï¼šç½‘å…³è¿™ä¸€å±‚å¯ä»¥æƒé™æ ¡éªŒï¼Œé™æµæ§åˆ¶

![img](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202206291359675.png)

**ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ**

1. Route(è·¯ç”±) - è·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—,å®ƒç”±ID,ç›®æ ‡URI,ä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆ,å¦‚æ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”±ï¼›
2. Predicate(æ–­è¨€) - å‚è€ƒçš„æ˜¯Java8çš„java.util.function.Predicateï¼Œå¼€å‘äººå‘˜å¯ä»¥åŒ¹é…==HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹==(ä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°),å¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”±ï¼›
3. Filter(è¿‡æ»¤) - æŒ‡çš„æ˜¯Springæ¡†æ¶ä¸­GatewayFilterçš„å®ä¾‹,ä½¿ç”¨è¿‡æ»¤å™¨,å¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹ã€‚

ä¸€å¥è¯æ€»ç»“ï¼šè¯·æ±‚åˆ°è¾¾ç½‘å…³ï¼Œå…ˆ **Predicate** æ˜¯å¦ç¬¦åˆæŸä¸ªè·¯ç”±è§„åˆ™ï¼Œç¬¦åˆå°± **Route** åˆ°æŒ‡å®šåœ°æ–¹ï¼Œä½†éœ€è¦ç»è¿‡ä¸€ç³»åˆ— **Filter** è¿›è¡Œè¿‡æ»¤



**æˆ‘ä»¬ç›®å‰ä¸æƒ³æš´éœ²8001ç«¯å£ï¼Œå¸Œæœ›åœ¨8001å¤–é¢å¥—ä¸€å±‚9527**ï¼Œè¿™æ ·æœ‰äººæ”»å‡»æœ‰ä¸€å±‚æŒ¡ç€

- æ·»åŠ ç½‘å…³å‰ - http://localhost:8001/payment/get/1
- æ·»åŠ ç½‘å…³å - http://localhost:9527/payment/get/1
- ä¸¤è€…è®¿é—®æˆåŠŸï¼Œè¿”å›ç›¸åŒç»“æœ



### 2. é€šè¿‡[å¾®æœåŠ¡](https://so.csdn.net/so/search?q=å¾®æœåŠ¡&spm=1001.2101.3001.7020)åå®ç°åŠ¨æ€è·¯ç”±

é»˜è®¤æƒ…å†µä¸‹Gatewayä¼šæ ¹æ®æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡åˆ—è¡¨ï¼Œä»¥æ³¨å†Œä¸­å¿ƒä¸Šå¾®æœåŠ¡åä¸ºè·¯å¾„åˆ›å»ºåŠ¨æ€è·¯ç”±è¿›è¡Œè½¬å‘ï¼Œä»è€Œå®ç°åŠ¨æ€è·¯ç”±çš„åŠŸèƒ½ã€‚

1ã€ä¿®æ”¹9527çš„yml

> â‘ éœ€è¦æ³¨æ„çš„æ˜¯==uriçš„åè®®ä¸ºlbï¼ˆload-balancingï¼‰==ï¼Œè¡¨ç¤ºå¯ç”¨Gatewayçš„[è´Ÿè½½å‡è¡¡](https://so.csdn.net/so/search?q=è´Ÿè½½å‡è¡¡&spm=1001.2101.3001.7020)åŠŸèƒ½ã€‚
> â‘¡lb://serviceNameæ˜¯spring cloud gatewayåœ¨å¾®æœåŠ¡ä¸­è‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºçš„è´Ÿè½½å‡è¡¡uriï¼ˆè´Ÿè½½å‡è¡¡åˆ°æŒ‡å®šæœåŠ¡ï¼‰

```yaml
server:
  port: 9527
spring:
  application:
    name: cloud-gateway
  cloud:
    gateway:
      discovery:
        locator:
          enabled: true  #å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±
      routes:
        - id: payment_routh #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
          #uri: http://localhost:8001   #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
          uri: lb://cloud-payment-service
          predicates:
            - Path=/payment/get/**   #æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±

        - id: payment_routh2
          #uri: http://localhost:8001   #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
          uri: lb://cloud-payment-service
          predicates:
            - Path=/payment/lb/**   #æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±


eureka:
  instance:
    hostname: cloud-gateway-service
  client:
    service-url:
      register-with-eureka: true
      fetch-registry: true
      defaultZone: http://eureka7001.com:7001/eureka
```

2ã€æµ‹è¯•
â‘ å¯åŠ¨ä¸€ä¸ªeureka7001+ä¸¤ä¸ªæœåŠ¡æä¾›è€…8001/8002
â‘¡è®¿é—®http://localhost:9527/payment/lb

ä¼šå‘ç°8001å’Œ8002äº¤æ›¿å‡ºç°



**è¦ç»è¿‡ä¸‰å…³æ‰èƒ½è¿‡æ¥ï¼š**è¿™ç« å…¶å®å°±å­¦è¿™ä¸‰ä¸ªçš„é…ç½® ä¸»yaml

![image-20220630144816418](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202206301448361.png)

* **è·¯ç”±** Route

```bash
## ä¸¤ç§é…ç½®æ–¹å¼ï¼Œ1ï¼‰javaä»£ç @Configuration å’Œ  2ï¼‰yamlé…ç½®
## åœ°å€åˆ† 1ï¼‰é™æ€è·¯ç”± å’Œ 2ï¼‰åŠ¨æ€è·¯ç”±çš„åŠŸèƒ½ï¼ˆä¸å†™æ­»ä¸€ä¸ªåœ°å€ï¼‰

## è¸©å‘ï¼Œè®°ä½è·¯ç”±çš„å…ˆåé¡ºåºï¼Œä¸‹é¢è¿™æ ·ï¼Œç¬¬äºŒæ¡å°±ä¸ä¼šæ‰§è¡Œï¼ï¼ï¼éœ€è¦è°ƒæ•´è·¯ç”±é¡ºåº
predicates:
            - Path=/api/**
## åˆ«å¿˜äº† **
predicates:
       - Path=/api/product/**       
```



* **æ–­è¨€** Predicate

```bash
## è¯¥å‘½ä»¤ç›¸å½“äºå‘getè¯·æ±‚ï¼Œä¸”æ²¡å¸¦cookie
curl http://localhost:9527/payment/lb

## å¸¦cookieçš„
curl http://localhost:9527/payment/lb --cookie "chocolate=chip"
```



* **è¿‡æ»¤å™¨** Filter

```yaml
## å¯¹äº çš„è¯·æ±‚è·¯å¾„/red/blueï¼Œè¿™ä¼šå°†è·¯å¾„è®¾ç½®ä¸º/blueåœ¨å‘å‡ºä¸‹æ¸¸è¯·æ±‚ä¹‹å‰ã€‚è¯·æ³¨æ„ï¼Œç”±äº YAML è§„èŒƒï¼Œ$åº”å°†å…¶æ›¿æ¢ä¸ºã€‚$\
filters:
        - RewritePath=/red/?(?<segment>.*), /$\{segment}
 
## æ³¨æ„è¿™ä¸ªä¾‹å­ 
         - id: product_route
          uri: lb://gulimall-product
          predicates:
            - Path=/api/product/**
          filters:
            - RewritePath=/api/?(?<segment>.*), /$\{segment}
 ## å‰ç«¯é¡¹ç›®ï¼Œ/api
#### http://localhost:88/api/product/category/list/tree  http://localhost:10000/product/category/list/tree


## ä¸€èˆ¬æ˜¯ è‡ªå®šä¹‰å…¨å±€GlobalFilter
```



## ==------æœåŠ¡é…ç½®------==

ä¸‰å¥—ï¼š

1. Config + Bus

2. Alibaba Nacos
3. æºç¨‹çš„apolloï¼Œä¸Šæµ·æœ‰åäº›

## ä¸€ã€Config Ã—

> æ¯ä¸€ä¸ªModeléƒ½æœ‰ä¸€ä¸ª yamlï¼Œæ”¹çš„å¤ªç—›è‹¦ã€‚äºæ˜¯æœ‰äº† **æœåŠ¡é…ç½®** æŠ€æœ¯

3344 å°±æ˜¯é…ç½®æ€»æ§ä¸­å¿ƒè¿ Git è·å–å®ƒä¸Šé¢çš„ yaml

3355 å¯ä»¥é€šè¿‡ 3344 æ‹¿åˆ° Git ä¸Šçš„ yaml

![image-20220701143051906](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202207011430795.png)

**æ€ä¹ˆç©**

SpringCloud Configåˆ†ä¸º**æœåŠ¡ç«¯**å’Œ**å®¢æˆ·ç«¯**ä¸¤éƒ¨åˆ†ã€‚

* æœåŠ¡ç«¯ä¹Ÿç§°ä¸ºåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡åº”ç”¨ï¼Œç”¨æ¥è¿æ¥é…ç½®æœåŠ¡å™¨å¹¶ä¸ºå®¢æˆ·ç«¯æä¾›è·å–é…ç½®ä¿¡æ¯ï¼ŒåŠ å¯†/è§£å¯†ä¿¡æ¯ç­‰è®¿é—®æ¥å£ã€‚

* å®¢æˆ·ç«¯åˆ™æ˜¯é€šè¿‡æŒ‡å®šçš„é…ç½®ä¸­å¿ƒæ¥ç®¡ç†åº”ç”¨èµ„æºï¼Œä»¥åŠä¸ä¸šåŠ¡ç›¸å…³çš„é…ç½®å†…å®¹ï¼Œå¹¶åœ¨å¯åŠ¨çš„æ—¶å€™ä»é…ç½®ä¸­å¿ƒè·å–å’ŒåŠ è½½é…ç½®ä¿¡æ¯é…ç½®æœåŠ¡å™¨é»˜è®¤é‡‡ç”¨gitæ¥å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œè¿™æ ·å°±æœ‰åŠ©äºå¯¹ç¯å¢ƒé…ç½®è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡gitå®¢æˆ·ç«¯å·¥å…·æ¥æ–¹ä¾¿çš„ç®¡ç†å’Œè®¿é—®é…ç½®å†…å®¹ã€‚



### 1. Configé…ç½®æ€»æ§ä¸­å¿ƒæ­å»º

æœåŠ¡ç«¯ä½œç”¨ï¼šé…ç½®å¥½åèƒ½æ‹¿åˆ°Gitä¸­yamlçš„å†…å®¹



### 2. Configå®¢æˆ·ç«¯é…ç½®ä¸æµ‹è¯•

**bootstrap.ymlã€å·²è¸©å‘ï¼Œæ²¡æœ‰æ”¹åå­—ã€‘**

applicaiton.ymlæ˜¯ç”¨æˆ·çº§çš„èµ„æºé…ç½®é¡¹

bootstrap.ymlæ˜¯ç³»ç»Ÿçº§çš„ï¼Œä¼˜å…ˆçº§æ›´åŠ é«˜

Spring Cloudä¼šåˆ›å»ºä¸€ä¸ªBootstrap Contextï¼Œä½œä¸ºSpringåº”ç”¨çš„Application Contextçš„çˆ¶ä¸Šä¸‹æ–‡ã€‚

åˆå§‹åŒ–çš„æ—¶å€™ï¼ŒBootstrapContextè´Ÿè´£ä»å¤–éƒ¨æºåŠ è½½é…ç½®å±æ€§å¹¶è§£æé…ç½®ã€‚è¿™ä¸¤ä¸ªä¸Šä¸‹æ–‡å…±äº«ä¸€ä¸ªä»å¤–éƒ¨è·å–çš„Environmentã€‚

Bootstrapå±æ€§æœ‰é«˜ä¼˜å…ˆçº§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä¸ä¼šè¢«æœ¬åœ°é…ç½®è¦†ç›–ã€‚Bootstrap contextå’ŒApplication Contextæœ‰ç€ä¸åŒçš„çº¦å®šï¼Œæ‰€ä»¥æ–°å¢äº†ä¸€ä¸ªbootstrap.ymlæ–‡ä»¶ï¼Œä¿è¯Bootstrap Contextå’ŒApplication Contexté…ç½®çš„åˆ†ç¦»ã€‚

è¦å°†Clientæ¨¡å—ä¸‹çš„application.ymlæ–‡ä»¶æ”¹ä¸ºbootstrap.yml,è¿™æ˜¯å¾ˆå…³é”®çš„ï¼Œå› ä¸ºbootstrap.ymlæ˜¯æ¯”application.ymlå…ˆåŠ è½½çš„ã€‚bootstrap.ymlä¼˜å…ˆçº§é«˜äºapplication.ymlã€‚

**ä¸¤ä¸ªå›¾æ ‡éƒ½ä¸ä¸€æ ·ï¼š**3355ä¸æ”¹æˆ bootstrap.yaml çš„è¯ @Value("${config.info}") ä¼šæŠ¥é”™ï¼

å› ä¸ºæœ¬åœ° application.yaml æ²¡æœ‰ï¼Œbootstrap.yaml -> é…ç½®ä¸­å¿ƒåœ°å€ -> Git ä¸Šæœ‰ï¼config.info

![image-20220701151424183](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202207011514318.png)



### 3. ConfigåŠ¨æ€åˆ·æ–°ä¹‹æ‰‹åŠ¨ç‰ˆ

> é—®é¢˜ï¼šGitee ä¸Šä¿®æ”¹ yamlï¼Œ3344é…ç½®ä¸­å¿ƒåˆ·æ–°æ˜¯ä¿®æ”¹çš„ï¼Œä½†æ˜¯3355å®¢æˆ·ç«¯æ˜¯æ²¡æœ‰ä¿®æ”¹éœ€è¦é‡å¯æ‰ç”Ÿæ•ˆ
>
> è§£å†³ï¼šä¸‰æ­¥ 1ï¼‰åŠ actuator  2ï¼‰ä¸€ä¸ªæ³¨è§£  3ï¼‰è¿ç»´å¤šç”¨ä¸€ä¸ªbashå‘½ä»¤

```bash
curl -X POST "http://localhost:3355/actuator/refresh"
```



## ==------æœåŠ¡æ€»çº¿------==

## ä¸€ã€Bus Ã—

> **å¯¹ Config çš„ä¸€ä¸ªåŠ å¼ºï¼Œå¯ä»¥å®ç°è‡ªåŠ¨ç‰ˆçš„ä¸€ä¸ªåŠ¨æ€åˆ·æ–°**  Config + Bus
>
> æ³¨æ„ï¼šSpring cloud Busç›®å‰æ”¯æŒRabbitMQå’ŒKafkaã€‚

**æ¶ˆæ¯æ€»çº¿**ï¼šå¯ä»¥æƒ³è±¡æˆå¾®ä¿¡è®¢é˜…å·



ç”±äºæ²¡å­¦ RabbitMQ å°±ç•¥è¿‡è¿™èŠ‚...



## ==------Other------==

## ä¸€ã€Streamâœ”

> æ³¨æ„ï¼šç›®å‰ä»…æ”¯æŒRabbitMQã€ Kafkaã€‚æƒ³ç”¨RocketMQ å°±åé¢å­¦Alibaba

æœ‰æ²¡æœ‰ä¸€ç§æ–°çš„æŠ€æœ¯è¯ç”Ÿï¼Œè®©æˆ‘ä»¬ä¸å†å…³æ³¨å…·ä½“MQçš„ç»†èŠ‚ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨ä¸€ç§é€‚é…ç»‘å®šçš„æ–¹å¼ï¼Œè‡ªåŠ¨çš„ç»™æˆ‘ä»¬åœ¨å„ç§MQå†…åˆ‡æ¢ã€‚ï¼ˆç±»ä¼¼äºHibernateï¼‰

Cloud Streamæ˜¯ä»€ä¹ˆï¼Ÿå±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶çš„å·®å¼‚ï¼Œé™ä½åˆ‡æ¢æˆæœ¬ï¼Œç»Ÿä¸€æ¶ˆæ¯çš„**ç¼–ç¨‹æ¨¡å‹**ã€‚

ä¸ªäººæ„Ÿè§‰ï¼šåƒä¸€ä¸ªé€‚é…å™¨ JDBC å±è”½äº†å„ä¸åŒæ•°æ®åº“çš„å·®å¼‚

![image-20220701165550123](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202207011655575.png)

**é€šè¿‡å®šä¹‰ç»‘å®šå™¨Binderä½œä¸ºä¸­é—´å±‚ï¼Œå®ç°äº†åº”ç”¨ç¨‹åºä¸æ¶ˆæ¯ä¸­é—´ä»¶ç»†èŠ‚ä¹‹é—´çš„éš”ç¦»**ã€‚



ç”±äºæ²¡å­¦MQç•¥ã€‚ã€‚ã€‚



## äºŒã€Sleuthé“¾è·¯ç›‘æ§âœ”

> sleuthç›‘æ§ã€zipkinå±•ç°

å¤§è‡´å°±éœ€è¦ç›‘æ§çš„åŠ pom æ”¹yaml   ä¾‹å¦‚æœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…(è°ƒç”¨æ–¹)éƒ½è¿™ä¹ˆå¹²

pom:

```xml
<!--åŒ…å«äº†sleuth+zipkin-->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-zipkin</artifactId>
</dependency>
```

yaml:

```yaml
spring:
  application:
    name: cloud-payment-service

  zipkin: #<-------------------------------------å…³é”® 
      base-url: http://localhost:9411
  sleuth: #<-------------------------------------å…³é”®
    sampler:
    #é‡‡æ ·ç‡å€¼ä»‹äº 0 åˆ° 1 ä¹‹é—´ï¼Œ1 åˆ™è¡¨ç¤ºå…¨éƒ¨é‡‡é›†
    probability: 1
```



ç„¶åè°ƒç”¨åè¿›å…¥ç›‘æ§ç½‘ç«™å¯ä»¥çœ‹åˆ°å“ªä¸ªæœåŠ¡è°ƒçš„å“ªä¸ªæœåŠ¡ï¼Œè€—æ—¶å¤šå°‘æ¯«ç§’

æ„Ÿè§‰ç®€å•å°±æ²¡æœ‰å®æ“äº†ï¼





## ==++++++<font color=blue>SpringCloud alibaba</font>++++++==

**ç®€ä»‹ï¼š**

* ä¸ºä»€ä¹ˆä¼šå‡ºç°SpringCloud alibaba
  * Spring Cloud Netflixé¡¹ç›®è¿›å…¥ç»´æŠ¤æ¨¡å¼
  * https://spring.io/blog/2018/12/12/spring-cloud-greenwich-rc1-available-now

* ä»€ä¹ˆæ˜¯ç»´æŠ¤æ¨¡å¼ï¼Ÿ

  * å°†æ¨¡å—ç½®äºç»´æŠ¤æ¨¡å¼ï¼Œæ„å‘³ç€Spring Cloudå›¢é˜Ÿå°†ä¸ä¼šå†å‘æ¨¡å—æ·»åŠ æ–°åŠŸèƒ½ã€‚

  

**èƒ½å¹²å˜›ï¼š**

* æœåŠ¡é™æµé™çº§ï¼šé»˜è®¤æ”¯æŒ WebServletã€WebFlux, OpenFeignã€RestTemplateã€Spring Cloud Gateway, Zuul, Dubbo å’Œ RocketMQ é™æµé™çº§åŠŸèƒ½çš„æ¥å…¥ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡æ§åˆ¶å°å®æ—¶ä¿®æ”¹é™æµé™çº§è§„åˆ™ï¼Œè¿˜æ”¯æŒæŸ¥çœ‹é™æµé™çº§ Metrics ç›‘æ§ã€‚
* æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼šé€‚é… Spring Cloud æœåŠ¡æ³¨å†Œä¸å‘ç°æ ‡å‡†ï¼Œé»˜è®¤é›†æˆäº† Ribbon çš„æ”¯æŒã€‚
* åˆ†å¸ƒå¼é…ç½®ç®¡ç†ï¼šæ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨åŒ–é…ç½®ï¼Œé…ç½®æ›´æ”¹æ—¶è‡ªåŠ¨åˆ·æ–°ã€‚
* æ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ï¼šåŸºäº Spring Cloud Stream ä¸ºå¾®æœåŠ¡åº”ç”¨æ„å»ºæ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ã€‚
* åˆ†å¸ƒå¼äº‹åŠ¡ï¼šä½¿ç”¨ @GlobalTransactional æ³¨è§£ï¼Œ é«˜æ•ˆå¹¶ä¸”å¯¹ä¸šåŠ¡é›¶ä¾µå…¥åœ°è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚
* é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ï¼šé˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ”¯æŒåœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹å­˜å‚¨å’Œè®¿é—®ä»»æ„ç±»å‹çš„æ•°æ®ã€‚
* åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ï¼šæä¾›ç§’çº§ã€ç²¾å‡†ã€é«˜å¯é ã€é«˜å¯ç”¨çš„å®šæ—¶ï¼ˆåŸºäº Cron è¡¨è¾¾å¼ï¼‰ä»»åŠ¡è°ƒåº¦æœåŠ¡ã€‚åŒæ—¶æä¾›åˆ†å¸ƒå¼çš„ä»»åŠ¡æ‰§è¡Œæ¨¡å‹ï¼Œå¦‚ç½‘æ ¼ä»»åŠ¡ã€‚ç½‘æ ¼ä»»åŠ¡æ”¯æŒæµ·é‡å­ä»»åŠ¡å‡åŒ€åˆ†é…åˆ°æ‰€æœ‰ Workerï¼ˆschedulerx-clientï¼‰ä¸Šæ‰§è¡Œã€‚
* é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡ï¼šè¦†ç›–å…¨çƒçš„çŸ­ä¿¡æœåŠ¡ï¼Œå‹å¥½ã€é«˜æ•ˆã€æ™ºèƒ½çš„äº’è”åŒ–é€šè®¯èƒ½åŠ›ï¼Œå¸®åŠ©ä¼ä¸šè¿…é€Ÿæ­å»ºå®¢æˆ·è§¦è¾¾é€šé“ã€‚



**æ€ä¹ˆç©ï¼š**

* **[Sentinel](https://github.com/alibaba/Sentinel)**ï¼šæŠŠæµé‡ä½œä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§
* **[Nacos](https://github.com/alibaba/Nacos)**ï¼šä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ã€‚
* **[RocketMQ](https://rocketmq.apache.org/)**ï¼šä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿï¼ŒåŸºäºé«˜å¯ç”¨åˆ†å¸ƒå¼é›†ç¾¤æŠ€æœ¯ï¼Œæä¾›ä½å»¶æ—¶çš„ã€é«˜å¯é çš„æ¶ˆæ¯å‘å¸ƒä¸è®¢é˜…æœåŠ¡ã€‚
* **[Dubbo](https://github.com/apache/dubbo)**ï¼šApache Dubboâ„¢ æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½ Java RPC æ¡†æ¶ã€‚
* **[Seata](https://github.com/seata/seata)**ï¼šé˜¿é‡Œå·´å·´å¼€æºäº§å“ï¼Œä¸€ä¸ªæ˜“äºä½¿ç”¨çš„é«˜æ€§èƒ½å¾®æœåŠ¡åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚
* **[Alibaba Cloud OSS](https://www.aliyun.com/product/oss)**: é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼ˆObject Storage Serviceï¼Œç®€ç§° OSSï¼‰ï¼Œæ˜¯é˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ‚¨å¯ä»¥åœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹å­˜å‚¨å’Œè®¿é—®ä»»æ„ç±»å‹çš„æ•°æ®ã€‚
* **[Alibaba Cloud SchedulerX](https://help.aliyun.com/document_detail/43136.html)**: é˜¿é‡Œä¸­é—´ä»¶å›¢é˜Ÿå¼€å‘çš„ä¸€æ¬¾åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦äº§å“ï¼Œæä¾›ç§’çº§ã€ç²¾å‡†ã€é«˜å¯é ã€é«˜å¯ç”¨çš„å®šæ—¶ï¼ˆåŸºäº Cron è¡¨è¾¾å¼ï¼‰ä»»åŠ¡è°ƒåº¦æœåŠ¡ã€‚
* **[Alibaba Cloud SMS](https://www.aliyun.com/product/sms)**: è¦†ç›–å…¨çƒçš„çŸ­ä¿¡æœåŠ¡ï¼Œå‹å¥½ã€é«˜æ•ˆã€æ™ºèƒ½çš„äº’è”åŒ–é€šè®¯èƒ½åŠ›ï¼Œå¸®åŠ©ä¼ä¸šè¿…é€Ÿæ­å»ºå®¢æˆ·è§¦è¾¾é€šé“ã€‚



**Spring Cloud Alibabaå­¦ä¹ èµ„æ–™è·å–ï¼š**

* å®˜ç½‘

  * https://spring.io/projects/spring-cloud-alibaba#overview

* è‹±æ–‡

  * https://github.com/alibaba/spring-cloud-alibaba

  * https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html

* ä¸­æ–‡
  * https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md



## ä¸€ã€Nacos æœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ

> Nacos = Eureka + Config + Bus    Nacosè‡´åŠ›äºå¸®åŠ©æ‚¨å‘ç°ã€é…ç½®å’Œç®¡ç†å¾®æœåŠ¡ã€‚
>
> æœåŠ¡æ³¨å†Œä¸­å¿ƒ + æœåŠ¡é…ç½® + æœåŠ¡æ€»çº¿



**ä¸ºä»€ä¹ˆå«Nacos**

- å‰å››ä¸ªå­—æ¯åˆ†åˆ«ä¸ºNamingå’ŒConfigurationçš„å‰ä¸¤ä¸ªå­—æ¯ï¼Œæœ€åçš„sä¸ºServiceã€‚



**æ€ä¹ˆç”¨**

ä¸ç”¨åƒ Eureka è¿˜è¦æ•´ä¸ªé¡¹ç›®è·‘èµ·æ¥ï¼Œè¿™ä¸ªåƒ zookeeper

è§£å‹å®‰è£…åŒ…ï¼Œç›´æ¥è¿è¡Œbinç›®å½•ä¸‹çš„startup.cmdï¼Œä½†æ˜¯å®æµ‹ä¼šæŠ¥é”™ã€‚éœ€åœ¨å‘½ä»¤è¡ŒåŠ æ¡ä»¶è·‘è¿™ä¸ªcmd

```bash
startup.cmd -m standalone
```

 

ä¸ºäº†ä¸‹ä¸€ç« èŠ‚æ¼”ç¤ºnacosçš„è´Ÿè½½å‡è¡¡ï¼Œå‚ç…§9001æ–°å»º9002

è¿™é‡Œ**å–å·§**ä¸æƒ³æ–°å»ºé‡å¤ä½“åŠ›åŠ³åŠ¨ï¼Œå¯ä»¥åˆ©ç”¨IDEAåŠŸèƒ½ï¼Œç›´æ¥æ‹·è´**è™šæ‹Ÿç«¯å£æ˜ å°„**



![image-20220706152115283](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202207202219473.png)



K8SæœåŠ¡å’ŒDNSæœåŠ¡åˆ™é€‚ç”¨äºCPæ¨¡å¼



Nacos æ˜¯ AP + CP å¯ä»¥åˆ‡æ¢

åˆ‡æ¢å‘½ä»¤ï¼š

```bash
curl -X PUT '$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode&value=CP
```



æ³¨æ„ï¼šæ–°çš„nacoså·²ç»æ²¡æœ‰æ•´åˆribbonäº†ï¼Œæ‰€ä»¥è¦ä¹ˆåœ¨mavenæ·»åŠ Loadbalancerä»£æ›¿





### 1. æ³¨å†Œä¸­å¿ƒï¼šä»£æ›¿ Eureka 

* å°±æ˜¯å¯åŠ¨é¡¹ç›®æ¢ä¸‹é…ç½®ï¼Œcmdå¯åŠ¨å®Œåé¡¹ç›®ä¸€èˆ¬å°±æ˜¯ä¸‰æ­¥ï¼š
  1. é…ç½® Nacos server-addr çš„åœ°å€
  2. é…ç½®è‡ªå·±çš„ application nameï¼ˆæ³¨æ„ï¼šæ¯ä¸€ä¸ªåº”ç”¨éƒ½åº”è¯¥æœ‰åå­—ï¼Œè¿™æ ·æ‰èƒ½æ³¨å†Œä¸Šå»ã€‚ï¼‰
  3. ==ä¸»å¯åŠ¨ç±»åŠ  @EnableDiscoveryClient== å¼€å¯æœåŠ¡çš„æ³¨å†Œä¸å‘ç°åŠŸèƒ½ï¼ˆå®¹æ˜“å¿˜ï¼‰

### 2. é…ç½®ä¸­å¿ƒï¼šä»£æ›¿ Bus

* Buséœ€è¦åœ¨ Git ä¸Šå»ºé…ç½®ï¼ŒNacosç›´æ¥å¯ä»¥åœ¨ç½‘ç«™ä¸­é…ç½®
* å¸¸è§„æ“ä½œï¼Œä¸€æ ·å»º Model ä¸€ç³»åˆ—

#### é…ç½®æ–‡ä»¶è¯¦è§£

Nacosä¸­çš„dataidï¼ˆå³ç½‘ç«™é…ç½®æ–‡ä»¶çš„åå­—ï¼‰éœ€ç¬¦åˆï¼š

![img](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202207062139577.png)

```java
${prefix}-${spring-profile.active}.${file-extension}

å³

${spring.application.name)}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}
```

æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå¦‚æœé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰é…config é»˜è®¤æ˜¯ gulimall-coupon.properties  é¡¹ç›®å.properties

æµ‹è¯•ï¼šdiscovery config è¦é…ç½®åˆ° bootstrap.yaml æ‰ç”Ÿæ•ˆã€‚å°±æ˜¯ææ”¹ä¸Šé¢è¿™ä¸ª.properties åˆ°applicationä¸ç”Ÿæ•ˆåˆ°bootstrapç”Ÿæ•ˆ  ==è‡ªæˆ‘å»ºè®®æŠŠ nacos ç›¸å…³çš„é… bootstrap==

å°æŠ€å·§ï¼šåº”ç”¨å¯åŠ¨çš„æ—¶å€™ç¬¬ä¸€è¡Œæ—¥å¿—ä¼šå‘Šè¯‰ä½  Nacos é…ç½®ä¸­å¿ƒçš„æ–‡ä»¶åæ˜¯ä»€ä¹ˆ



#### common.yaml

æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡shared-configsé…ç½®å…¬ç”¨çš„çš„é…ç½®ï¼Œæ¯”å¦‚æ³¨å†Œä¸­å¿ƒå¤§å®¶éƒ½ç”¨åŒä¸€ä¸ªï¼Œredisçš„ä¹Ÿå¯èƒ½æ˜¯å¤šä¸ªæœåŠ¡ç”¨åŒä¸€ä¸ªé…ç½®ï¼š

`shared-dataids: common.yaml`



é†‰äº†ï¼šå†™è¿™ä¸ªData IDä¸€å®šè¦åŠ åç¼€ã€‚æ•´äº†å¾ˆä¹…æ‰å‘ç°è¿™ä¸ªé—®é¢˜

![image-20230106154116757](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202301061541889.png)



bootstrap.yml å¯ä»¥ç†è§£æˆç³»ç»Ÿçº§åˆ«çš„ä¸€äº›å‚æ•°é…ç½®ï¼Œè¿™äº›å‚æ•°ä¸€èˆ¬æ˜¯ä¸ä¼šå˜åŠ¨çš„ã€‚
application.yml å¯ä»¥ç”¨æ¥å®šä¹‰åº”ç”¨çº§åˆ«çš„ã€‚



**è‡ªå¸¦åŠ¨æ€åˆ·æ–°**

éœ€è¦åœ¨ä½¿ç”¨äº† `@Value` çš„ ==Controller ç±»==ä¸­åŠ  `@RefreshScope //æ”¯æŒNacosçš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ã€‚`  æ‰èƒ½åŠ¨æ€åˆ·æ–°

ä¿®æ”¹ä¸‹Nacosä¸­çš„yamlé…ç½®æ–‡ä»¶ï¼Œå†æ¬¡è°ƒç”¨æŸ¥çœ‹é…ç½®çš„æ¥å£ï¼Œå°±ä¼šå‘ç°é…ç½®å·²ç»åˆ·æ–°ã€‚



**ä»…ä»…æ˜¯ä»¥ä¸ŠåŠŸèƒ½è¿˜ä¸è¡Œï¼Œè¿˜æœ‰ Bus æ²¡æœ‰çš„å¥½åŠŸèƒ½ï¼š**

åˆ‡æ¢dev testé…ç½®æ–‡ä»¶ç¯å¢ƒï¼Œåˆ†ç»„..å¾ˆæ–¹ä¾¿ï¼Œçœ‹å›¾ï¼šé…ç½®æ–‡ä»¶-->å‘½åç©ºé—´-->ç»„

è‡ªæˆ‘å»ºè®®ï¼šNameSpaceï¼ˆå¾®æœåŠ¡ï¼‰ã€Groupï¼ˆå¼€å‘ç¯å¢ƒï¼‰

æœ€ç»ˆæ–¹æ¡ˆï¼šæ¯ä¸ªå¾®æœåŠ¡åˆ›å»ºè‡ªå·±çš„å‘½åç©ºé—´ï¼Œç„¶åä½¿ç”¨é…ç½®åˆ†ç»„åŒºåˆ†ç¯å¢ƒï¼ˆdev/test/prodï¼‰

![img](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202207070955519.png)

é»˜è®¤æƒ…å†µï¼šNamespace=publicï¼ŒGroup=DEFAULT_GROUPï¼Œé»˜è®¤Clusteræ˜¯DEFAULT

* Nacosé»˜è®¤çš„Namespaceæ˜¯publicï¼Œ**Namespaceä¸»è¦ç”¨æ¥å®ç°é…ç½®éš”ç¦»**ã€‚
  * åŸºäºç¯å¢ƒè¿›è¡Œéš”ç¦»ï¼šæ¯”æ–¹è¯´æˆ‘ä»¬ç°åœ¨æœ‰ä¸‰ä¸ªç¯å¢ƒï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸‰ä¸ªNamespaceï¼Œä¸åŒçš„Namespaceä¹‹é—´æ˜¯éš”ç¦»çš„ã€‚
  * åŸºäºå¾®æœåŠ¡è¿›è¡Œéš”ç¦»ï¼šä¹Ÿå¯ä»¥æ¯”å¦‚ç»™ä¸åŒçš„modelåˆ›å»ºå®ƒè‡ªå·±çš„å‘½åç©ºé—´
  * **å†™æ³•** `spring.cloud.nacos.config.namespace=e53d5e82-a1f3-42b9-a1d2-1cbbd8103d69`
* Groupé»˜è®¤æ˜¯DEFAULT_GROUPï¼ŒGroupå¯ä»¥æŠŠä¸åŒçš„å¾®æœåŠ¡åˆ’åˆ†åˆ°åŒä¸€ä¸ªåˆ†ç»„é‡Œé¢å»
  * ä¾‹å¦‚åŒåä¸€ç”¨è¿™ç»„ï¼Œ618ç”¨å¦å¤–ä¸€ç»„
  * ä¹Ÿå¯åŒºåˆ†å¼€å‘ç¯å¢ƒ dev pro

* Serviceå°±æ˜¯å¾®æœåŠ¡:ä¸€ä¸ªServiceå¯ä»¥åŒ…å«å¤šä¸ªCluster (é›†ç¾¤)ï¼ŒNacosé»˜è®¤Clusteræ˜¯DEFAULTï¼ŒClusteræ˜¯å¯¹æŒ‡å®šå¾®æœåŠ¡çš„ä¸€ä¸ªè™šæ‹Ÿåˆ’åˆ†ã€‚
  * æ¯”æ–¹è¯´ä¸ºäº†å®¹ç¾ï¼Œå°†Serviceå¾®æœåŠ¡åˆ†åˆ«éƒ¨ç½²åœ¨äº†æ­å·æœºæˆ¿å’Œå¹¿å·æœºæˆ¿ï¼Œè¿™æ—¶å°±å¯ä»¥ç»™æ­å·æœºæˆ¿çš„Serviceå¾®æœåŠ¡èµ·ä¸€ä¸ªé›†ç¾¤åç§°(HZ) ï¼Œç»™å¹¿å·æœºæˆ¿çš„Serviceå¾®æœåŠ¡èµ·ä¸€ä¸ªé›†ç¾¤åç§°(GZ)ï¼Œè¿˜å¯ä»¥å°½é‡è®©åŒä¸€ä¸ªæœºæˆ¿çš„å¾®æœåŠ¡äº’ç›¸è°ƒç”¨ï¼Œä»¥æå‡æ€§èƒ½ã€‚
* æœ€åæ˜¯Instanceï¼Œå°±æ˜¯å¾®æœåŠ¡çš„å®ä¾‹ã€‚



**åŠ è½½å¤šé…ç½®é›†**

å…¶å®æˆ‘ä»¬çš„å¾®æœåŠ¡åªéœ€ä¿ç•™ä¸€ä¸ª bootstrap.yaml

æˆ‘ä»¬è¦æŠŠåŸæ¥application.ymlé‡Œçš„å†…å®¹éƒ½åˆ†æ–‡ä»¶æŠ½ç¦»å‡ºå»ã€‚æˆ‘ä»¬åœ¨nacosé‡Œåˆ›å»ºå¥½ åï¼Œåœ¨couponsé‡ŒæŒ‡å®šè¦å¯¼å…¥çš„é…ç½®å³å¯ã€‚

![image-20220805173159065](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202208051732942.png)

 é‡ç‚¹ï¼š **spring.cloud.nacos.config.ext-config[0]**

```yaml
spring.cloud.nacos.config.namespace=ed042b3b-b7f3-4734-bdcb-0c516cb357d7  # å¯ä»¥é€‰æ‹©å¯¹åº”çš„å‘½åç©ºé—´ ï¼Œå³å†™ä¸Šå¯¹åº”ç¯å¢ƒçš„å‘½åç©ºé—´ID
spring.cloud.nacos.config.group=dev  # é…ç½®æ–‡ä»¶æ‰€åœ¨çš„ç»„

spring.cloud.nacos.config.ext-config[0].data-id=datasource.yml
spring.cloud.nacos.config.ext-config[0].group=dev
spring.cloud.nacos.config.ext-config[0].refresh=true

spring.cloud.nacos.config.ext-config[1].data-id=mybatis.yml
spring.cloud.nacos.config.ext-config[1].group=dev
spring.cloud.nacos.config.ext-config[1].refresh=true

spring.cloud.nacos.config.ext-config[2].data-id=other.yml
spring.cloud.nacos.config.ext-config[2].group=dev
spring.cloud.nacos.config.ext-config[2].refresh=true
```



å…¶å®ä»¥ä¸Šè¿™äº›éƒ½æ˜¯å°å„¿ç§‘ï¼Œè‡ªå·±çœ‹çœ‹æ–‡æ¡£å®¹æ˜“çŸ¥é“ã€‚



### 3. Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®ï¼ˆé‡è¦ï¼‰

>é›†ç¾¤ï¼šè‡³å°‘ä¸‰å°
>
>æŒä¹…åŒ–



[å®˜æ–¹æ–‡æ¡£](https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html)

VIPï¼šä¸æ˜¯ very important personï¼Œè€Œæ˜¯ **virtual** **IP**

![img](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202207071007185.png)

ä¸Šå›¾å®˜ç½‘ç¿»è¯‘ï¼ŒçœŸå®æƒ…å†µ

![img](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202207071008218.png)

é»˜è®¤Nacosä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“å®ç°æ•°æ®çš„å­˜å‚¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¯åŠ¨å¤šä¸ªé»˜è®¤é…ç½®ä¸‹çš„NacosèŠ‚ç‚¹ï¼Œæ•°æ®å­˜å‚¨æ˜¯å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ**Nacosé‡‡ç”¨äº†é›†ä¸­å¼å­˜å‚¨çš„æ–¹å¼æ¥æ”¯æŒé›†ç¾¤åŒ–éƒ¨ç½²ï¼Œç›®å‰åªæ”¯æŒMySQLçš„å­˜å‚¨**ã€‚

é€šä¿—çš„è¯´ï¼šé›†ç¾¤æœ‰ä¸‰ä¸ªçš„è¯ï¼Œæ¯ä¸€ä¸ªNacoséƒ½æœ‰è‡ªå·±åµŒå…¥å¼æ•°æ®åº“å°±ä¼šæ•°æ®ä¸ä¸€è‡´ã€‚è€Œéƒ½ç”¨å¤–é¢ä¸€ä¸ªMySQLå°±ä¸ä¼šæœ‰è¿™ç§é—®é¢˜ã€‚



**é»˜è®¤æ•°æ®åº“derbyåˆ‡æ¢åˆ°MySQLå…·ä½“çœ‹å®˜æ–¹æ–‡æ¡£å°±è¡Œã€‚**



Linux é…ç½®

![img](https://pub-83c20763effa4ac69b4d6a9e22c9936e.r2.dev/img/202207071436995.png)



## [äºŒã€Sentinel ç†”æ–­ä¸é™æµ](https://github.com/NiceSeason/gulimall-learning/blob/master/docs/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E9%AB%98%E7%BA%A7.md#1-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-3)

> Sentinelæ˜¯é¢å‘åˆ†å¸ƒå¼æœåŠ¡æ¶æ„çš„æµé‡æ§åˆ¶ç»„ä»¶ï¼Œä¸»è¦ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦æ¥å¸®åŠ©æ‚¨ä¿éšœå¾®æœåŠ¡çš„==ç¨³å®šæ€§==ã€‚

Hystrixä¸Sentinelæ¯”è¾ƒï¼š

* Hystrix
  1. éœ€è¦æˆ‘ä»¬ç¨‹åºå‘˜è‡ªå·±æ‰‹å·¥æ­å»ºç›‘æ§å¹³å°
  2. æ²¡æœ‰ä¸€å¥—webç•Œé¢å¯ä»¥ç»™æˆ‘ä»¬è¿›è¡Œæ›´åŠ ç»†ç²’åº¦åŒ–å¾—é…ç½®æµæ§ã€é€Ÿç‡æ§åˆ¶ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™çº§

* Sentinel
  1. å•ç‹¬ä¸€ä¸ªç»„ä»¶ï¼Œå¯ä»¥ç‹¬ç«‹å‡ºæ¥ã€‚
  2. ç›´æ¥ç•Œé¢åŒ–çš„ç»†ç²’åº¦ç»Ÿä¸€é…ç½®ã€‚



çº¦å®š > é…ç½® > ç¼–ç 

éƒ½å¯ä»¥å†™åœ¨ä»£ç é‡Œé¢ï¼Œä½†æ˜¯æˆ‘ä»¬æœ¬æ¬¡è¿˜æ˜¯å¤§è§„æ¨¡çš„å­¦ä¹ ä½¿ç”¨é…ç½®å’Œæ³¨è§£çš„æ–¹å¼ï¼Œå°½é‡å°‘å†™ä»£ç 

### 1. æµæ§

> ç›´æ¥webç•Œé¢dashboard å¯ä»¥è®¾ç½®æ¯ç§’åªå‡†è®¿é—®ä¸€æ¬¡ï¼Œå¦åˆ™  Blocked by Sentinel (flow limiting)å¯ä»¥é€šè¿‡`WebCallbackManager.setUrlBlockHandler()`ä¿®æ”¹è¿™ä¸€å¥
>
> æµæ§è®¾ç½®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œé‡å¯å¤±æ•ˆ
>
> æ¯ä¸€ä¸ªå¾®æœåŠ¡éƒ½å¯¼å…¥actuatorï¼ˆå°±ä¼šæœ‰ç»Ÿè®¡ä¿¡æ¯ï¼‰;å¹¶é…åˆmanagement.endpoints.web.exposure.include=*

#### 1.1 Sentinelæµæ§-å…³è”

> å°±åƒä¸€ä¸ªå‡ºæ°´å£ä¸€ä¸ªå…¥æ°´å£ï¼Œæˆ‘è¿™è¾¹çš„æ”¯ä»˜æ¥å£æŒ‚äº†ä½ é‚£è¾¹ä¸‹å•çš„è®¢å•æ¥å£å°±ä¸è¦é‚£ä¹ˆçŒ›äº†

**ä¸è¦èŠ±ç²¾åŠ›åœ¨è¿™äº›å·¥å…·ä¸Šé¢ï¼Œå¤Ÿç”¨å°±è¡Œäº†ã€‚æŠŠç²¾åŠ›æ”¾åˆ°ä¸»è¦çŸ›ç›¾ä¸Šé¢ï¼Œç”¨ postmanã€jmeter éƒ½å¯ä»¥**



#### 1.2 Sentinelæµæ§-é¢„çƒ­

å…·ä½“çœ‹åˆ«äººç¬”è®°

**åº”ç”¨åœºæ™¯**

å¦‚ï¼šç§’æ€ç³»ç»Ÿåœ¨å¼€å¯çš„ç¬é—´ï¼Œä¼šæœ‰å¾ˆå¤šæµé‡ä¸Šæ¥ï¼Œå¾ˆæœ‰å¯èƒ½æŠŠç³»ç»Ÿæ‰“æ­»ï¼Œé¢„çƒ­æ–¹å¼å°±æ˜¯æŠŠä¸ºäº†ä¿æŠ¤ç³»ç»Ÿï¼Œå¯æ…¢æ…¢çš„æŠŠæµé‡æ”¾è¿›æ¥,æ…¢æ…¢çš„æŠŠé˜€å€¼å¢é•¿åˆ°è®¾ç½®çš„é˜€å€¼ã€‚



### 2. ç†”æ–­/é™çº§

RTï¼šRound trip å¾€è¿”ã€æ¥å›ï¼ŒRound trip Time å¾€è¿”æ—¶é—´ï¼Œå³å“åº”æ—¶é—´

å¾€ä¸‹éƒ¨åˆ†ç•¥è¿‡ï¼Œå»ºè®®çœ‹æ–‡æ¡£ã€‚[å®˜æ–¹æ–‡æ¡£](https://github.com/alibaba/Sentinel/wiki/ç†”æ–­é™çº§)



ç†”æ–­ï¼šä¿è¯æœåŠ¡ä¸å—çº§è”å½±å“ã€‚ä¾‹å¦‚è¯·æ±‚è°ƒç”¨é“¾è·¯ a->b->c  cæ˜¯ä¸å¯ç”¨çš„è¿‡3sæ‰æ‰§è¡Œåˆ°ä¸šåŠ¡çš„é”™è¯¯ç‚¹è¿”å›ç»™bä¸å¯ç”¨ï¼Œåé¢çš„æ— æ•°ä¸ªa bä»¥åŠè°ƒç”¨açš„å¤§é‡å †ç§¯  ç†”æ–­çš„è¯ç›´æ¥å¿«é€Ÿå“åº”å¤±è´¥å°±ä¸ä¼šå †ç§¯äº†é•¿æ—¶é—´çš„å¡æ­»

é™çº§ï¼šäºæµé‡é«˜å³°æœŸï¼Œå¯¹éæ ¸å¿ƒä¸šåŠ¡åœæ­¢æœåŠ¡æˆ–æ‰€æœ‰çš„è°ƒç”¨ç›´æ¥è¿”å›é™çº§æ•°æ®
æœåŠ¡é™çº§æŒ‡çš„æ˜¯å½“æœåŠ¡å™¨å‹åŠ›å‰§å¢çš„æƒ…å†µä¸‹,æ ¹æ®å½“å‰ä¸šåŠ¡æƒ…å†µåŠæµé‡å¯¹ä¸€äº›æœåŠ¡å’Œé¡µé¢æœ‰ç­–ç•¥çš„é™çº§,ä»¥æ­¤é‡Šæ”¾æœåŠ¡å™¨èµ„æºä»¥ä¿è¯æ ¸å¿ƒä»»åŠ¡çš„æ­£å¸¸è¿è¡Œ.é™çº§çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ä¸¢è½¦ä¿å¸…,ä¼˜å…ˆä¿è¯æ ¸å¿ƒä¸šåŠ¡.
å¸¸è§çš„æœåŠ¡é™çº§ç­–ç•¥æœ‰ä»¥ä¸‹å‡ ç§ï¼š

* é™çº§é¡µé¢ï¼šå½“æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œæ˜¾ç¤ºä¸€ä¸ªç®€åŒ–çš„é¡µé¢æˆ–è€…é”™è¯¯ä¿¡æ¯ï¼Œä»£æ›¿åŸæœ¬çš„åŠŸèƒ½é¡µé¢ï¼Œå‘ç”¨æˆ·ä¼ è¾¾æœåŠ¡ä¸å¯ç”¨çš„ä¿¡æ¯ã€‚
* å¼‚æ­¥å¤„ç†ï¼šå°†åŸæœ¬åŒæ­¥çš„æœåŠ¡è°ƒç”¨æ”¹ä¸ºå¼‚æ­¥è°ƒç”¨ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æˆ–è€…å¼‚æ­¥ä»»åŠ¡æ¥å¤„ç†è¯·æ±‚ï¼Œé¿å…å› æœåŠ¡ä¸å¯ç”¨è€Œé˜»å¡æ•´ä¸ªç³»ç»Ÿã€‚

ç›¸åŒç‚¹ï¼š 

1. ä¸ºäº†ä¿è¯é›†ç¾¤å¤§éƒ¨åˆ†æœåŠ¡çš„å¯ç”¨æ€§å’Œå¯é æ€§ï¼Œé˜²æ­¢å´©æºƒï¼Œç‰ºç‰²å°æˆ‘
2. ç”¨æˆ·æœ€ç»ˆéƒ½æ˜¯ä½“éªŒåˆ°æŸä¸ªåŠŸèƒ½ä¸å¯ç”¨

ä¸åŒç‚¹ï¼š 

1. ç†”æ–­æ˜¯è¢«è°ƒç”¨æ–¹æ•…éšœï¼Œè§¦å‘çš„**ç³»ç»Ÿä¸»åŠ¨è§„åˆ™**
2. é™çº§æ˜¯åŸºäºå…¨å±€è€ƒè™‘ï¼Œåœæ­¢ä¸€äº›æ­£å¸¸æœåŠ¡ï¼Œé‡Šæ”¾èµ„æº





### 3. SentinelResourceé…ç½®

å…œåº•æ–¹æ³•ï¼Œåˆ†ä¸ºç³»ç»Ÿé»˜è®¤å’Œå®¢æˆ·è‡ªå®šä¹‰ï¼Œä¸¤ç§

ä¹‹å‰çš„caseï¼Œé™æµå‡ºé—®é¢˜åï¼Œéƒ½æ˜¯ç”¨sentinelç³»ç»Ÿé»˜è®¤çš„æç¤º: Blocked by Sentinel (flow limiting)

æˆ‘ä»¬èƒ½ä¸èƒ½è‡ªå®šï¼Ÿç±»ä¼¼hystrixï¼ŒæŸä¸ªæ–¹æ³•å‡ºé—®é¢˜äº†ï¼Œå°±æ‰¾å¯¹åº”çš„å…œåº•é™çº§æ–¹æ³•?

ç»“è®º  **ä»HystrixCommandåˆ°@SentinelResource**



**Sentinel æ²¡æœ‰å­¦ä¸‹å»ï¼Œæš‚æ—¶è·³è¿‡åæœŸç”¨çš„æ—¶å€™å†æ¥å­¦ï¼**





### [4. GitHub wikiæ–‡æ¡£](https://sentinelguard.io/zh-cn/docs/basic-api-resource-rule.html)

> Gulimall è¡¥å……

**èµ„æº** æ˜¯ Sentinel ä¸­çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€

æˆ‘ä»¬è¯´çš„èµ„æºï¼Œå¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼ŒæœåŠ¡ï¼ŒæœåŠ¡é‡Œçš„æ–¹æ³•ï¼Œç”šè‡³æ˜¯ä¸€æ®µä»£ç ã€‚ä½¿ç”¨ Sentinel æ¥è¿›è¡Œèµ„æºä¿æŠ¤ï¼Œä¸»è¦åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤:

1. å®šä¹‰èµ„æº
2. å®šä¹‰è§„åˆ™
3. æ£€éªŒè§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ



## [ä¸‰ã€Seata å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡](https://seata.io/zh-cn/docs/overview/what-is-seata.html)

[ç§»åˆ°å…¶ä»–ç¬”è®°](../DistributedLock/Seata&XTS)



## Other

### ä¸€ã€spring bootå¤šæœåŠ¡é¡¹ç›®ä¸æ˜¾ç¤ºserviceçª—å£

**æ‰“å¼€è¿™ä¸ªæ–‡ä»¶.idea > workspace.xml ä¸­æœç´¢ RunDashboardï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º**

```xml
  <component name="RunDashboard">
    <option name="configurationTypes">
      <set>
        <option value="SpringBootApplicationConfigurationType" />
      </set>
    </option>
    <option name="ruleStates">
      <list>
        <RuleState>
          <option name="name" value="ConfigurationTypeDashboardGroupingRule" />
        </RuleState>
        <RuleState>
          <option name="name" value="StatusDashboardGroupingRule" />
        </RuleState>
      </list>
    </option>
  </component>
```

